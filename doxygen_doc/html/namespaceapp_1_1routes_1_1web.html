<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CaliTrabaja: Referencia del espacio de nombres app.routes.web</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CaliTrabaja
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generado por Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Buscar',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespaceapp_1_1routes_1_1web.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Cargando...</div>
<div class="SRStatus" id="Searching">Buscando...</div>
<div class="SRStatus" id="NoMatches">Nada coincide</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Referencia del espacio de nombres app.routes.web</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Funciones</h2></td></tr>
<tr class="memitem:a910fd96eccac8237f26e7d678fae59ed" id="r_a910fd96eccac8237f26e7d678fae59ed"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a910fd96eccac8237f26e7d678fae59ed">inject_user_role</a> ()</td></tr>
<tr class="memitem:a8cfc4918e2251376871123bf5e850c31" id="r_a8cfc4918e2251376871123bf5e850c31"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cfc4918e2251376871123bf5e850c31">inicio</a> ()</td></tr>
<tr class="memitem:a674c23b112a05ba0fe27159584a71756" id="r_a674c23b112a05ba0fe27159584a71756"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a674c23b112a05ba0fe27159584a71756">registrarse</a> ()</td></tr>
<tr class="memitem:a9d5531cd2dfc9a3f18ae5b5ad651c553" id="r_a9d5531cd2dfc9a3f18ae5b5ad651c553"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d5531cd2dfc9a3f18ae5b5ad651c553">iniciar_sesion</a> ()</td></tr>
<tr class="memitem:a9d1379589e366795e8dbc1c212cd46d2" id="r_a9d1379589e366795e8dbc1c212cd46d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d1379589e366795e8dbc1c212cd46d2">cerrar_sesion</a> ()</td></tr>
<tr class="memitem:abde5578dc9c7bb99d60033d2ec293b4b" id="r_abde5578dc9c7bb99d60033d2ec293b4b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abde5578dc9c7bb99d60033d2ec293b4b">guia_usuario</a> ()</td></tr>
<tr class="memitem:aa7ca01d33ec36ba1dbdada1b070ed0d5" id="r_aa7ca01d33ec36ba1dbdada1b070ed0d5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa7ca01d33ec36ba1dbdada1b070ed0d5">configuracion</a> ()</td></tr>
<tr class="memitem:a5c18813395deed06c7951fe9d149018c" id="r_a5c18813395deed06c7951fe9d149018c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5c18813395deed06c7951fe9d149018c">cambiar_contraseña</a> ()</td></tr>
<tr class="memitem:ac504bfbd845df97961d7184ce0e5e303" id="r_ac504bfbd845df97961d7184ce0e5e303"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac504bfbd845df97961d7184ce0e5e303">deshabilitar_cuenta</a> ()</td></tr>
<tr class="memitem:a0228dc7ce803b6703a75bc99f9051641" id="r_a0228dc7ce803b6703a75bc99f9051641"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0228dc7ce803b6703a75bc99f9051641">validar_contrasena_ajax</a> ()</td></tr>
<tr class="memitem:aa8af600731d489cfbdbf4ae4c0b09eb9" id="r_aa8af600731d489cfbdbf4ae4c0b09eb9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa8af600731d489cfbdbf4ae4c0b09eb9">recuperar_contraseña</a> ()</td></tr>
<tr class="memitem:ad4099408206ff7d18558c5c73540b32b" id="r_ad4099408206ff7d18558c5c73540b32b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad4099408206ff7d18558c5c73540b32b">restablecer_contraseña</a> (token)</td></tr>
<tr class="memitem:a8785dfd9c0e0a347563626676490cf57" id="r_a8785dfd9c0e0a347563626676490cf57"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8785dfd9c0e0a347563626676490cf57">publicaciones</a> ()</td></tr>
<tr class="memitem:aa2180aefeaff7c70fbed288e2207144f" id="r_aa2180aefeaff7c70fbed288e2207144f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa2180aefeaff7c70fbed288e2207144f">perfil_cliente</a> ()</td></tr>
<tr class="memitem:aaf57460241109a2cf3e0f6f48faf313a" id="r_aaf57460241109a2cf3e0f6f48faf313a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf57460241109a2cf3e0f6f48faf313a">perfil_foto</a> (filename)</td></tr>
<tr class="memitem:a5d4a67cf82c5a2a9d75434d1822b3fd5" id="r_a5d4a67cf82c5a2a9d75434d1822b3fd5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d4a67cf82c5a2a9d75434d1822b3fd5">perfil_experto</a> ()</td></tr>
<tr class="memitem:ac1498a43650431cfb8d6e1dded6d247b" id="r_ac1498a43650431cfb8d6e1dded6d247b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac1498a43650431cfb8d6e1dded6d247b">guardar_publicacion</a> (publicacion_id)</td></tr>
<tr class="memitem:a1e910d866ac1356bdb37291825f9b9c7" id="r_a1e910d866ac1356bdb37291825f9b9c7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1e910d866ac1356bdb37291825f9b9c7">guardados</a> ()</td></tr>
<tr class="memitem:aca64e0d7e81f0cc2706ce9bff4899a8e" id="r_aca64e0d7e81f0cc2706ce9bff4899a8e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca64e0d7e81f0cc2706ce9bff4899a8e">eliminar_guardado</a> (publicacion_id)</td></tr>
<tr class="memitem:a52a7c75dd432913dfd64f7391fa4f1c6" id="r_a52a7c75dd432913dfd64f7391fa4f1c6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a52a7c75dd432913dfd64f7391fa4f1c6">convertir_a_experto</a> ()</td></tr>
<tr class="memitem:a3de09f075a944227e3d185b5ed054a45" id="r_a3de09f075a944227e3d185b5ed054a45"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3de09f075a944227e3d185b5ed054a45">convertir_a_cliente</a> ()</td></tr>
<tr class="memitem:aa1a416b1122a2929cc5fa43068dfc792" id="r_aa1a416b1122a2929cc5fa43068dfc792"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1a416b1122a2929cc5fa43068dfc792">perfil_general</a> ()</td></tr>
<tr class="memitem:a7e58aa6de3c2bbfd3b25ece18fcc68f6" id="r_a7e58aa6de3c2bbfd3b25ece18fcc68f6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7e58aa6de3c2bbfd3b25ece18fcc68f6">perfil_experto_publico</a> (usuario_id)</td></tr>
<tr class="memitem:a5b44cc5a9532b88894a248ff60e03f01" id="r_a5b44cc5a9532b88894a248ff60e03f01"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5b44cc5a9532b88894a248ff60e03f01">mis_publicaciones</a> ()</td></tr>
<tr class="memitem:a4b9c50a5472bd8ff39a0f40f9e06f293" id="r_a4b9c50a5472bd8ff39a0f40f9e06f293"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4b9c50a5472bd8ff39a0f40f9e06f293">guardar_mi_publicacion</a> ()</td></tr>
<tr class="memitem:a10eafdfd53286678024bb79b12af82ac" id="r_a10eafdfd53286678024bb79b12af82ac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a10eafdfd53286678024bb79b12af82ac">editar_mi_publicacion</a> (publicacion_id)</td></tr>
<tr class="memitem:ab1db317e74f0ba09191d295d26f45601" id="r_ab1db317e74f0ba09191d295d26f45601"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab1db317e74f0ba09191d295d26f45601">eliminar_mi_publicacion</a> (publicacion_id)</td></tr>
<tr class="memitem:ac87fcb9bb982bc89112dd28ba1e8b10a" id="r_ac87fcb9bb982bc89112dd28ba1e8b10a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac87fcb9bb982bc89112dd28ba1e8b10a">obtener_subcategorias</a> (categoria_id)</td></tr>
<tr class="memitem:a786cfa2babdf5f350d193970ca00f2db" id="r_a786cfa2babdf5f350d193970ca00f2db"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a786cfa2babdf5f350d193970ca00f2db">obtener_promocion</a> ()</td></tr>
<tr class="memitem:a716597e79ee52043355538634cf56c0d" id="r_a716597e79ee52043355538634cf56c0d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a716597e79ee52043355538634cf56c0d">promocionar_publicacion</a> (publicacion_id)</td></tr>
<tr class="memitem:a219d8d886d7e967d24249dc3b1648513" id="r_a219d8d886d7e967d24249dc3b1648513"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a219d8d886d7e967d24249dc3b1648513">guardar_reporte</a> ()</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab295390199450310c31d57559261d172" id="r_ab295390199450310c31d57559261d172"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab295390199450310c31d57559261d172">web</a> = Blueprint('web', __name__)</td></tr>
</table>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Documentación de funciones</h2>
<a id="a5c18813395deed06c7951fe9d149018c" name="a5c18813395deed06c7951fe9d149018c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c18813395deed06c7951fe9d149018c">&#9670;&#160;</a></span>cambiar_contraseña()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.cambiar_contraseña </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00148">148</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  148</span><span class="keyword">def </span>cambiar_contraseña():</div>
<div class="line"><span class="lineno">  149</span>    <span class="comment"># Verificar si el usuario ha iniciado sesión</span></div>
<div class="line"><span class="lineno">  150</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result[<span class="stringliteral">&quot;authenticated&quot;</span>]:</div>
<div class="line"><span class="lineno">  152</span>        flash(auth_result[<span class="stringliteral">&quot;message&quot;</span>], <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))  <span class="comment"># O &#39;web.index&#39;</span></div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>    data = request.form.to_dict()</div>
<div class="line"><span class="lineno">  156</span>    resultado = cambiar_contrasena_service(data)</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>    categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">  159</span>    flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error inesperado.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.configuracion&#39;</span>))</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span><span class="comment"># Ruta para deshabilitar la cuenta</span></div>
<div class="line"><span class="lineno">  165</span><span class="preprocessor">@web.route(&#39;/configuracion/deshabilitar_cuenta&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d1379589e366795e8dbc1c212cd46d2" name="a9d1379589e366795e8dbc1c212cd46d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d1379589e366795e8dbc1c212cd46d2">&#9670;&#160;</a></span>cerrar_sesion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.cerrar_sesion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00112">112</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  112</span><span class="keyword">def </span>cerrar_sesion():</div>
<div class="line"><span class="lineno">  113</span>    cerrar_sesion_service()</div>
<div class="line"><span class="lineno">  114</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span><span class="comment">#Ruta para guia de usuario</span></div>
<div class="line"><span class="lineno">  117</span><span class="preprocessor">@web.route(&#39;/guia_usuario&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa7ca01d33ec36ba1dbdada1b070ed0d5" name="aa7ca01d33ec36ba1dbdada1b070ed0d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7ca01d33ec36ba1dbdada1b070ed0d5">&#9670;&#160;</a></span>configuracion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.configuracion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00123">123</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  123</span><span class="keyword">def </span>configuracion():</div>
<div class="line"><span class="lineno">  124</span>    <span class="comment"># Verificar autenticación</span></div>
<div class="line"><span class="lineno">  125</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  126</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  127</span>        flash(auth_result.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  128</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))  <span class="comment"># o la ruta que quieras para login</span></div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  131</span>        <span class="comment"># Aquí solo lanzamos un mensaje o puedes implementar algo después</span></div>
<div class="line"><span class="lineno">  132</span>        flash(<span class="stringliteral">&quot;Formulario enviado correctamente.&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>)</div>
<div class="line"><span class="lineno">  133</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.configuracion&#39;</span>))</div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>    <span class="comment"># Obtener los datos del usuario (nombre, rol y fecha de registro)</span></div>
<div class="line"><span class="lineno">  136</span>    resultado = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">  137</span>    primer_nombre = resultado.get(<span class="stringliteral">&quot;primer_nombre&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title()</div>
<div class="line"><span class="lineno">  138</span>    primer_apellido = resultado.get(<span class="stringliteral">&quot;primer_apellido&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title()</div>
<div class="line"><span class="lineno">  139</span>    rol = resultado.get(<span class="stringliteral">&quot;rol&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title()</div>
<div class="line"><span class="lineno">  140</span>    fecha_registro = resultado.get(<span class="stringliteral">&quot;fecha_registro&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="comment"># Pasamos todos los datos a la plantilla</span></div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;configuracion.html&#39;</span>, primer_nombre=primer_nombre, primer_apellido=primer_apellido, rol=rol, fecha_registro=fecha_registro)</div>
<div class="line"><span class="lineno">  144</span> </div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span><span class="comment"># Ruta para cambiar la contraseña</span></div>
<div class="line"><span class="lineno">  147</span><span class="preprocessor">@web.route(&#39;/configuracion/cambiar_contraseña&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3de09f075a944227e3d185b5ed054a45" name="a3de09f075a944227e3d185b5ed054a45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3de09f075a944227e3d185b5ed054a45">&#9670;&#160;</a></span>convertir_a_cliente()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.convertir_a_cliente </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00524">524</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  524</span><span class="keyword">def </span>convertir_a_cliente():</div>
<div class="line"><span class="lineno">  525</span>    resultado = cambiar_rol_a_cliente_service()</div>
<div class="line"><span class="lineno">  526</span>    flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;success&quot;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_cliente&#39;</span>))</div>
<div class="line"><span class="lineno">  528</span> </div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span><span class="preprocessor">@web.route(&#39;/perfil&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52a7c75dd432913dfd64f7391fa4f1c6" name="a52a7c75dd432913dfd64f7391fa4f1c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52a7c75dd432913dfd64f7391fa4f1c6">&#9670;&#160;</a></span>convertir_a_experto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.convertir_a_experto </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00516">516</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  516</span><span class="keyword">def </span>convertir_a_experto():</div>
<div class="line"><span class="lineno">  517</span>    resultado = cambiar_rol_a_experto_service()</div>
<div class="line"><span class="lineno">  518</span>    flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;success&quot;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  519</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_experto&#39;</span>))</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span><span class="preprocessor">@web.route(&#39;/convertirse_en_cliente&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac504bfbd845df97961d7184ce0e5e303" name="ac504bfbd845df97961d7184ce0e5e303"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac504bfbd845df97961d7184ce0e5e303">&#9670;&#160;</a></span>deshabilitar_cuenta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.deshabilitar_cuenta </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00166">166</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  166</span><span class="keyword">def </span>deshabilitar_cuenta():</div>
<div class="line"><span class="lineno">  167</span>    <span class="comment"># Verificar si el usuario está autenticado</span></div>
<div class="line"><span class="lineno">  168</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  169</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result[<span class="stringliteral">&quot;authenticated&quot;</span>]:</div>
<div class="line"><span class="lineno">  170</span>        flash(auth_result[<span class="stringliteral">&quot;message&quot;</span>], <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  171</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>    data = request.form.to_dict()</div>
<div class="line"><span class="lineno">  174</span>    resultado = deshabilitar_cuenta_service(data)</div>
<div class="line"><span class="lineno">  175</span> </div>
<div class="line"><span class="lineno">  176</span>    categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">  177</span>    flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error inesperado.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  178</span> </div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>):</div>
<div class="line"><span class="lineno">  180</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))  <span class="comment"># Redirige a la página principal o donde prefieras</span></div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.configuracion&#39;</span>))</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span> </div>
<div class="line"><span class="lineno">  185</span><span class="comment"># Ruta para validar la contraseña y abrir modal </span></div>
<div class="line"><span class="lineno">  186</span><span class="preprocessor">@web.route(&#39;/configuracion/validar_contrasena&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a10eafdfd53286678024bb79b12af82ac" name="a10eafdfd53286678024bb79b12af82ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a10eafdfd53286678024bb79b12af82ac">&#9670;&#160;</a></span>editar_mi_publicacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.editar_mi_publicacion </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>publicacion_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00694">694</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  694</span><span class="keyword">def </span>editar_mi_publicacion(publicacion_id):</div>
<div class="line"><span class="lineno">  695</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  696</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  697</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para editar tus publicaciones&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  698</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.login&#39;</span>))</div>
<div class="line"><span class="lineno">  699</span> </div>
<div class="line"><span class="lineno">  700</span>    publicaciones = obtener_mis_publicaciones_service(usuario_id)</div>
<div class="line"><span class="lineno">  701</span>    categorias = obtener_categorias_service()</div>
<div class="line"><span class="lineno">  702</span>    subcategorias = obtener_subcategorias_service()</div>
<div class="line"><span class="lineno">  703</span>    publicacion = obtener_publicacion_por_id_service(publicacion_id)</div>
<div class="line"><span class="lineno">  704</span>    conteo = contar_publicaciones_usuario(usuario_id)</div>
<div class="line"><span class="lineno">  705</span> </div>
<div class="line"><span class="lineno">  706</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> publicacion <span class="keywordflow">or</span> publicacion.usuario_id != usuario_id:</div>
<div class="line"><span class="lineno">  707</span>        flash(<span class="stringliteral">&quot;No tienes permiso para editar esta publicación&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  708</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  709</span> </div>
<div class="line"><span class="lineno">  710</span>    tiene_publicaciones = any(</div>
<div class="line"><span class="lineno">  711</span>        pub.titulo <span class="keywordflow">and</span> pub.descripcion_publicacion</div>
<div class="line"><span class="lineno">  712</span>        <span class="keywordflow">for</span> pub <span class="keywordflow">in</span> publicaciones</div>
<div class="line"><span class="lineno">  713</span>    )</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  716</span>        <span class="stringliteral">&#39;mis_publicaciones.html&#39;</span>,</div>
<div class="line"><span class="lineno">  717</span>        publicaciones=publicaciones,</div>
<div class="line"><span class="lineno">  718</span>        categorias=categorias,</div>
<div class="line"><span class="lineno">  719</span>        subcategorias=subcategorias,</div>
<div class="line"><span class="lineno">  720</span>        publicacion=publicacion,</div>
<div class="line"><span class="lineno">  721</span>        tiene_publicaciones=tiene_publicaciones,</div>
<div class="line"><span class="lineno">  722</span>        cantidad_actual=conteo[<span class="stringliteral">&quot;cantidad_actual&quot;</span>],</div>
<div class="line"><span class="lineno">  723</span>        limite_maximo=conteo[<span class="stringliteral">&quot;limite_maximo&quot;</span>],</div>
<div class="line"><span class="lineno">  724</span>        slots_vacios=conteo[<span class="stringliteral">&quot;slots_vacios&quot;</span>]  <span class="comment"># 👈 Ahora sí se pasa al template</span></div>
<div class="line"><span class="lineno">  725</span>    )</div>
<div class="line"><span class="lineno">  726</span> </div>
<div class="line"><span class="lineno">  727</span> </div>
<div class="line"><span class="lineno">  728</span> </div>
<div class="line"><span class="lineno">  729</span> </div>
<div class="line"><span class="lineno">  730</span><span class="preprocessor">@web.route(&#39;/mis-publicaciones/eliminar/&lt;int:publicacion_id&gt;&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aca64e0d7e81f0cc2706ce9bff4899a8e" name="aca64e0d7e81f0cc2706ce9bff4899a8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca64e0d7e81f0cc2706ce9bff4899a8e">&#9670;&#160;</a></span>eliminar_guardado()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.eliminar_guardado </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>publicacion_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00505">505</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  505</span><span class="keyword">def </span>eliminar_guardado(publicacion_id):</div>
<div class="line"><span class="lineno">  506</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  507</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  508</span>        <span class="keywordflow">return</span> jsonify(success=<span class="keyword">False</span>, message=<span class="stringliteral">&quot;Debes iniciar sesión para eliminar guardados&quot;</span>), 401</div>
<div class="line"><span class="lineno">  509</span> </div>
<div class="line"><span class="lineno">  510</span>    resultado = eliminar_guardado_service(publicacion_id)</div>
<div class="line"><span class="lineno">  511</span>    <span class="keywordflow">return</span> jsonify(success=resultado[<span class="stringliteral">&#39;success&#39;</span>], message=resultado[<span class="stringliteral">&#39;message&#39;</span>])</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span><span class="comment"># Ruta para publicaciones del experto</span></div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span><span class="preprocessor">@web.route(&#39;/convertirse_en_experto&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab1db317e74f0ba09191d295d26f45601" name="ab1db317e74f0ba09191d295d26f45601"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1db317e74f0ba09191d295d26f45601">&#9670;&#160;</a></span>eliminar_mi_publicacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.eliminar_mi_publicacion </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>publicacion_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00731">731</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  731</span><span class="keyword">def </span>eliminar_mi_publicacion(publicacion_id):</div>
<div class="line"><span class="lineno">  732</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  733</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  734</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para eliminar publicaciones&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  735</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.login&#39;</span>))</div>
<div class="line"><span class="lineno">  736</span> </div>
<div class="line"><span class="lineno">  737</span>    publicacion = obtener_publicacion_por_id_service(publicacion_id)</div>
<div class="line"><span class="lineno">  738</span>    </div>
<div class="line"><span class="lineno">  739</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> publicacion:</div>
<div class="line"><span class="lineno">  740</span>        flash(<span class="stringliteral">&quot;La publicación no existe&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  741</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  742</span> </div>
<div class="line"><span class="lineno">  743</span>    <span class="keywordflow">if</span> publicacion.usuario_id != usuario_id:</div>
<div class="line"><span class="lineno">  744</span>        flash(<span class="stringliteral">&quot;No tienes permiso para eliminar esta publicación&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  745</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  746</span> </div>
<div class="line"><span class="lineno">  747</span>    resultado = eliminar_publicacion_service(publicacion_id)</div>
<div class="line"><span class="lineno">  748</span>    flash(resultado[<span class="stringliteral">&#39;message&#39;</span>], <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado[<span class="stringliteral">&#39;success&#39;</span>] <span class="keywordflow">else</span> <span class="stringliteral">&#39;danger&#39;</span>)</div>
<div class="line"><span class="lineno">  749</span> </div>
<div class="line"><span class="lineno">  750</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  751</span> </div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span> </div>
<div class="line"><span class="lineno">  754</span> </div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span><span class="preprocessor">@web.route(&#39;/subcategorias/&lt;int:categoria_id&gt;&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e910d866ac1356bdb37291825f9b9c7" name="a1e910d866ac1356bdb37291825f9b9c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e910d866ac1356bdb37291825f9b9c7">&#9670;&#160;</a></span>guardados()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.guardados </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00484">484</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  484</span><span class="keyword">def </span>guardados():</div>
<div class="line"><span class="lineno">  485</span>    <span class="comment"># Verificar autenticación con tu service</span></div>
<div class="line"><span class="lineno">  486</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  487</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  488</span>        flash(auth_result.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Debes iniciar sesión.&quot;</span>), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  489</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))</div>
<div class="line"><span class="lineno">  490</span> </div>
<div class="line"><span class="lineno">  491</span>    <span class="comment"># Obtener publicaciones guardadas</span></div>
<div class="line"><span class="lineno">  492</span>    publicaciones = obtener_guardados_service()</div>
<div class="line"><span class="lineno">  493</span> </div>
<div class="line"><span class="lineno">  494</span>    <span class="comment"># Obtener ID del usuario logueado desde tu service</span></div>
<div class="line"><span class="lineno">  495</span>    datos_usuario = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">  496</span>    id_usuario_logueado = datos_usuario.get(<span class="stringliteral">&quot;usuario_id&quot;</span>)</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  499</span>        <span class="stringliteral">&#39;guardados.html&#39;</span>,</div>
<div class="line"><span class="lineno">  500</span>        publicaciones=publicaciones,</div>
<div class="line"><span class="lineno">  501</span>        id_usuario_logueado=id_usuario_logueado</div>
<div class="line"><span class="lineno">  502</span>    )</div>
<div class="line"><span class="lineno">  503</span><span class="comment"># Ruta para eliminar un guardado@web.route(&#39;/mis-guardados/eliminar/&lt;int:publicacion_id&gt;&#39;)</span></div>
<div class="line"><span class="lineno">  504</span><span class="preprocessor">@web.route(&#39;/mis-guardados/eliminar/&lt;int:publicacion_id&gt;&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b9c50a5472bd8ff39a0f40f9e06f293" name="a4b9c50a5472bd8ff39a0f40f9e06f293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b9c50a5472bd8ff39a0f40f9e06f293">&#9670;&#160;</a></span>guardar_mi_publicacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.guardar_mi_publicacion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00659">659</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  659</span><span class="keyword">def </span>guardar_mi_publicacion():</div>
<div class="line"><span class="lineno">  660</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  661</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  662</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para realizar esta acción&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  663</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.login&#39;</span>))</div>
<div class="line"><span class="lineno">  664</span> </div>
<div class="line"><span class="lineno">  665</span>    data = dict(request.form)</div>
<div class="line"><span class="lineno">  666</span>    data[<span class="stringliteral">&#39;usuario_id&#39;</span>] = usuario_id</div>
<div class="line"><span class="lineno">  667</span> </div>
<div class="line"><span class="lineno">  668</span>    <span class="comment"># ✅ Validación de longitud máxima para la descripción</span></div>
<div class="line"><span class="lineno">  669</span>    descripcion = data.get(<span class="stringliteral">&quot;descripcion_publicacion&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">  670</span>    <span class="keywordflow">if</span> len(descripcion) &gt; 200:</div>
<div class="line"><span class="lineno">  671</span>        flash(<span class="stringliteral">&quot;La descripción no puede tener más de 200 caracteres.&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  672</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  673</span>    </div>
<div class="line"><span class="lineno">  674</span>    titulo = data.get(<span class="stringliteral">&quot;titulo&quot;</span>)</div>
<div class="line"><span class="lineno">  675</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> titulo:</div>
<div class="line"><span class="lineno">  676</span>        flash(<span class="stringliteral">&quot;Debe contener el titulo.&quot;</span>,<span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  677</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    <span class="comment"># ✅ Corregir claves si vienen con nombres del formulario como &#39;id_categoria&#39;</span></div>
<div class="line"><span class="lineno">  680</span>    <span class="keywordflow">if</span> <span class="stringliteral">&#39;id_categoria&#39;</span> <span class="keywordflow">in</span> data:</div>
<div class="line"><span class="lineno">  681</span>        data[<span class="stringliteral">&#39;categoria_id&#39;</span>] = data.pop(<span class="stringliteral">&#39;id_categoria&#39;</span>)</div>
<div class="line"><span class="lineno">  682</span> </div>
<div class="line"><span class="lineno">  683</span>    <span class="keywordflow">if</span> <span class="stringliteral">&#39;id_subcategoria&#39;</span> <span class="keywordflow">in</span> data:</div>
<div class="line"><span class="lineno">  684</span>        data[<span class="stringliteral">&#39;subcategoria_id&#39;</span>] = data.pop(<span class="stringliteral">&#39;id_subcategoria&#39;</span>)</div>
<div class="line"><span class="lineno">  685</span> </div>
<div class="line"><span class="lineno">  686</span>    resultado = guardar_mi_publicacion_service(data)</div>
<div class="line"><span class="lineno">  687</span>    categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">  688</span>    flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error al guardar publicación.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  689</span> </div>
<div class="line"><span class="lineno">  690</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  691</span> </div>
<div class="line"><span class="lineno">  692</span><span class="comment"># Editar publicación</span></div>
<div class="line"><span class="lineno">  693</span><span class="preprocessor">@web.route(&#39;/mis-publicaciones/editar/&lt;int:publicacion_id&gt;&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1498a43650431cfb8d6e1dded6d247b" name="ac1498a43650431cfb8d6e1dded6d247b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1498a43650431cfb8d6e1dded6d247b">&#9670;&#160;</a></span>guardar_publicacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.guardar_publicacion </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>publicacion_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00473">473</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  473</span><span class="keyword">def </span>guardar_publicacion(publicacion_id):</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  475</span>        resultado = guardar_publicacion_service(publicacion_id)</div>
<div class="line"><span class="lineno">  476</span>        <span class="keywordflow">return</span> jsonify(resultado), (200 <span class="keywordflow">if</span> resultado[<span class="stringliteral">&quot;success&quot;</span>] <span class="keywordflow">else</span> 400)</div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><span class="lineno">  478</span>        <span class="keyword">import</span> traceback</div>
<div class="line"><span class="lineno">  479</span>        traceback.print_exc()</div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">return</span> jsonify(success=<span class="keyword">False</span>, message=f<span class="stringliteral">&quot;Error interno: {str(e)}&quot;</span>), 500</div>
<div class="line"><span class="lineno">  481</span> </div>
<div class="line"><span class="lineno">  482</span> </div>
<div class="line"><span class="lineno">  483</span><span class="preprocessor">@web.route(&#39;/mis_guardados&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a219d8d886d7e967d24249dc3b1648513" name="a219d8d886d7e967d24249dc3b1648513"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a219d8d886d7e967d24249dc3b1648513">&#9670;&#160;</a></span>guardar_reporte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.guardar_reporte </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00835">835</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  835</span><span class="keyword">def </span>guardar_reporte():</div>
<div class="line"><span class="lineno">  836</span>    <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  837</span>        reportado_id = request.form.get(<span class="stringliteral">&#39;reportado_id&#39;</span>)</div>
<div class="line"><span class="lineno">  838</span>        reportador_id = request.form.get(<span class="stringliteral">&#39;reportador_id&#39;</span>)</div>
<div class="line"><span class="lineno">  839</span>        motivo = request.form.get(<span class="stringliteral">&#39;motivo&#39;</span>)</div>
<div class="line"><span class="lineno">  840</span>        descripcion = request.form.get(<span class="stringliteral">&#39;descripcion&#39;</span>)</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>        print(f<span class="stringliteral">&quot;DATOS: {reportado_id}, {reportador_id}, {motivo}, {descripcion}&quot;</span>)</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> reportado_id <span class="keywordflow">or</span> <span class="keywordflow">not</span> reportador_id <span class="keywordflow">or</span> <span class="keywordflow">not</span> motivo:</div>
<div class="line"><span class="lineno">  845</span>            flash(<span class="stringliteral">&quot;Faltan datos en el reporte&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  846</span>            <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&quot;web.inicio&quot;</span>))</div>
<div class="line"><span class="lineno">  847</span> </div>
<div class="line"><span class="lineno">  848</span>        nuevo_reporte = Reportes(</div>
<div class="line"><span class="lineno">  849</span>            descripcion_reporte=descripcion,</div>
<div class="line"><span class="lineno">  850</span>            fecha_reporte=date.today(),</div>
<div class="line"><span class="lineno">  851</span>            reportador_id=reportador_id,</div>
<div class="line"><span class="lineno">  852</span>            reportado_id=reportado_id</div>
<div class="line"><span class="lineno">  853</span>        )</div>
<div class="line"><span class="lineno">  854</span> </div>
<div class="line"><span class="lineno">  855</span>        db.session.add(nuevo_reporte)</div>
<div class="line"><span class="lineno">  856</span>        db.session.commit()</div>
<div class="line"><span class="lineno">  857</span>        flash(<span class="stringliteral">&quot;Reporte enviado correctamente&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>)</div>
<div class="line"><span class="lineno">  858</span>    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div>
<div class="line"><span class="lineno">  859</span>        db.session.rollback()</div>
<div class="line"><span class="lineno">  860</span>        flash(<span class="stringliteral">&quot;Error al guardar el reporte: &quot;</span> + str(e), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  861</span> </div>
<div class="line"><span class="lineno">  862</span>    <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&quot;web.inicio&quot;</span>))</div>
</div><!-- fragment -->
</div>
</div>
<a id="abde5578dc9c7bb99d60033d2ec293b4b" name="abde5578dc9c7bb99d60033d2ec293b4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abde5578dc9c7bb99d60033d2ec293b4b">&#9670;&#160;</a></span>guia_usuario()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.guia_usuario </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00118">118</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  118</span><span class="keyword">def </span>guia_usuario():</div>
<div class="line"><span class="lineno">  119</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;guia_usuario.html&#39;</span>)</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span><span class="comment"># Ruta para la configuración del usuario</span></div>
<div class="line"><span class="lineno">  122</span><span class="preprocessor">@web.route(&#39;/configuracion&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d5531cd2dfc9a3f18ae5b5ad651c553" name="a9d5531cd2dfc9a3f18ae5b5ad651c553"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d5531cd2dfc9a3f18ae5b5ad651c553">&#9670;&#160;</a></span>iniciar_sesion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.iniciar_sesion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00093">93</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span><span class="keyword">def </span>iniciar_sesion():</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">   95</span>        data = request.form.to_dict()</div>
<div class="line"><span class="lineno">   96</span>        resultado = iniciar_sesion_service(data)</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>        categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">   99</span>        flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error inesperado.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>        <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>):</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>            <span class="comment">#se añade la funcion login user para mantener la sesion activa (mensajeria)</span></div>
<div class="line"><span class="lineno">  104</span>            usuario = Usuario.query.filter_by(correo=data[<span class="stringliteral">&quot;correo&quot;</span>]).first()  <span class="comment"># Obtener usuario</span></div>
<div class="line"><span class="lineno">  105</span>            login_user(usuario)  <span class="comment"># Mantener sesión activa</span></div>
<div class="line"><span class="lineno">  106</span>            <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;iniciar_sesion.html&#39;</span>)</div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span><span class="comment"># Ruta para cerrar sesión</span></div>
<div class="line"><span class="lineno">  111</span><span class="preprocessor">@web.route(&#39;/cerrar_sesion&#39;, methods=[&#39;POST&#39;, &#39;GET&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8cfc4918e2251376871123bf5e850c31" name="a8cfc4918e2251376871123bf5e850c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cfc4918e2251376871123bf5e850c31">&#9670;&#160;</a></span>inicio()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.inicio </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00042">42</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   42</span><span class="keyword">def </span>inicio():</div>
<div class="line"><span class="lineno">   43</span>    publicaciones_recientes = obtener_publicaciones_recientes_service()</div>
<div class="line"><span class="lineno">   44</span>    publicaciones_aleatorias = obtener_publicaciones_aleatorias_service()</div>
<div class="line"><span class="lineno">   45</span>    rol_usuario = verificar_rol()  <span class="comment"># Verifica el rol del usuario autenticado</span></div>
<div class="line"><span class="lineno">   46</span>    primer_nombre = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="lineno">   47</span>    id_usuario_reportador = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   48</span>    </div>
<div class="line"><span class="lineno">   49</span>    publicaciones_guardadas_ids = []</div>
<div class="line"><span class="lineno">   50</span>    </div>
<div class="line"><span class="lineno">   51</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">   52</span> </div>
<div class="line"><span class="lineno">   53</span>    <span class="keywordflow">if</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">   54</span>        datos_usuario = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">   55</span>        primer_nombre = datos_usuario.get(<span class="stringliteral">&quot;primer_nombre&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title()</div>
<div class="line"><span class="lineno">   56</span>        usuario_id = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">   57</span>        id_usuario_reportador = usuario_id.get(<span class="stringliteral">&quot;usuario_id&quot;</span>)</div>
<div class="line"><span class="lineno">   58</span>        </div>
<div class="line"><span class="lineno">   59</span>        publicaciones_guardadas = obtener_guardados_service()</div>
<div class="line"><span class="lineno">   60</span>        publicaciones_guardadas_ids = [p.publicacion_id <span class="keywordflow">for</span> p <span class="keywordflow">in</span> publicaciones_guardadas]</div>
<div class="line"><span class="lineno">   61</span>        </div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">   64</span>        <span class="stringliteral">&#39;inicio.html&#39;</span>,</div>
<div class="line"><span class="lineno">   65</span>        primer_nombre=primer_nombre,</div>
<div class="line"><span class="lineno">   66</span>        publicaciones_recientes=publicaciones_recientes,</div>
<div class="line"><span class="lineno">   67</span>        publicaciones_aleatorias=publicaciones_aleatorias,</div>
<div class="line"><span class="lineno">   68</span>        rol_usuario=rol_usuario,</div>
<div class="line"><span class="lineno">   69</span>        id_usuario_logueado=id_usuario_reportador,</div>
<div class="line"><span class="lineno">   70</span>        publicaciones_guardadas_ids=publicaciones_guardadas_ids  </div>
<div class="line"><span class="lineno">   71</span>        </div>
<div class="line"><span class="lineno">   72</span>    )</div>
<div class="line"><span class="lineno">   73</span> </div>
<div class="line"><span class="lineno">   74</span> </div>
<div class="line"><span class="lineno">   75</span><span class="comment"># Ruta para registrarse (Formulario web)</span></div>
<div class="line"><span class="lineno">   76</span><span class="preprocessor">@web.route(&#39;/registrarse&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a910fd96eccac8237f26e7d678fae59ed" name="a910fd96eccac8237f26e7d678fae59ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a910fd96eccac8237f26e7d678fae59ed">&#9670;&#160;</a></span>inject_user_role()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.inject_user_role </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00033">33</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span><span class="keyword">def </span>inject_user_role():</div>
<div class="line"><span class="lineno">   34</span>    <span class="keywordflow">if</span> current_user.is_authenticated:</div>
<div class="line"><span class="lineno">   35</span>        print(<span class="stringliteral">&quot;&gt;&gt; Usuario autenticado:&quot;</span>, current_user.correo, <span class="stringliteral">&quot;Rol:&quot;</span>, current_user.id_rol)</div>
<div class="line"><span class="lineno">   36</span>        <span class="keywordflow">return</span> dict(rol_usuario=current_user.id_rol)</div>
<div class="line"><span class="lineno">   37</span>    print(<span class="stringliteral">&quot;&gt;&gt; Usuario no autenticado&quot;</span>)</div>
<div class="line"><span class="lineno">   38</span>    <span class="keywordflow">return</span> dict(rol_usuario=<span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">   39</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5b44cc5a9532b88894a248ff60e03f01" name="a5b44cc5a9532b88894a248ff60e03f01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b44cc5a9532b88894a248ff60e03f01">&#9670;&#160;</a></span>mis_publicaciones()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.mis_publicaciones </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00598">598</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  598</span><span class="keyword">def </span>mis_publicaciones():</div>
<div class="line"><span class="lineno">  599</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  600</span> </div>
<div class="line"><span class="lineno">  601</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  602</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para ver tus publicaciones&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  603</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))</div>
<div class="line"><span class="lineno">  604</span>    </div>
<div class="line"><span class="lineno">  605</span>     <span class="comment"># 🔹 Capturar si viene de Mercado Pago con promo=ok</span></div>
<div class="line"><span class="lineno">  606</span>    promo_status = request.args.get(<span class="stringliteral">&quot;promo&quot;</span>)</div>
<div class="line"><span class="lineno">  607</span>    <span class="keywordflow">if</span> promo_status == <span class="stringliteral">&quot;ok&quot;</span>:</div>
<div class="line"><span class="lineno">  608</span>        publicacion_id = session.pop(<span class="stringliteral">&quot;promo_publicacion_id&quot;</span>, <span class="keywordtype">None</span>)</div>
<div class="line"><span class="lineno">  609</span>        <span class="keywordflow">if</span> publicacion_id:</div>
<div class="line"><span class="lineno">  610</span>            publicacion = Publicaciones.query.get(publicacion_id)</div>
<div class="line"><span class="lineno">  611</span>            <span class="keywordflow">if</span> publicacion <span class="keywordflow">and</span> publicacion.usuario_id == usuario_id:</div>
<div class="line"><span class="lineno">  612</span>                publicacion.destacada = <span class="stringliteral">&quot;si&quot;</span></div>
<div class="line"><span class="lineno">  613</span>                db.session.commit()</div>
<div class="line"><span class="lineno">  614</span>                flash(<span class="stringliteral">&quot;¡Tu publicación ahora es destacada 🚀!&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>)</div>
<div class="line"><span class="lineno">  615</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  616</span>            <span class="comment"># Revisar si ya hay un slot vacío para este usuario</span></div>
<div class="line"><span class="lineno">  617</span>            slot = Publicaciones.query.filter_by(usuario_id=usuario_id, titulo=<span class="keywordtype">None</span>).first()</div>
<div class="line"><span class="lineno">  618</span>            <span class="keywordflow">if</span> <span class="keywordflow">not</span> slot:</div>
<div class="line"><span class="lineno">  619</span>                nueva = Publicaciones(</div>
<div class="line"><span class="lineno">  620</span>                    usuario_id=usuario_id,</div>
<div class="line"><span class="lineno">  621</span>                    fecha=datetime.now(),</div>
<div class="line"><span class="lineno">  622</span>                    estado=<span class="stringliteral">&quot;activo&quot;</span>,</div>
<div class="line"><span class="lineno">  623</span>                    destacada=<span class="stringliteral">&quot;si&quot;</span></div>
<div class="line"><span class="lineno">  624</span>                )</div>
<div class="line"><span class="lineno">  625</span>                db.session.add(nueva)</div>
<div class="line"><span class="lineno">  626</span>                db.session.commit()</div>
<div class="line"><span class="lineno">  627</span>                flash(<span class="stringliteral">&quot;¡Has desbloqueado una nueva publicación!&quot;</span>, <span class="stringliteral">&quot;success&quot;</span>)</div>
<div class="line"><span class="lineno">  628</span>    </div>
<div class="line"><span class="lineno">  629</span>    publicaciones = obtener_mis_publicaciones_service(usuario_id)</div>
<div class="line"><span class="lineno">  630</span>    categorias = obtener_categorias_service()</div>
<div class="line"><span class="lineno">  631</span>    subcategorias = obtener_subcategorias_service()</div>
<div class="line"><span class="lineno">  632</span>    conteo = contar_publicaciones_usuario(usuario_id)</div>
<div class="line"><span class="lineno">  633</span> </div>
<div class="line"><span class="lineno">  634</span>    tiene_publicaciones = any(</div>
<div class="line"><span class="lineno">  635</span>        pub.titulo <span class="keywordflow">and</span> pub.descripcion_publicacion</div>
<div class="line"><span class="lineno">  636</span>        <span class="keywordflow">for</span> pub <span class="keywordflow">in</span> publicaciones</div>
<div class="line"><span class="lineno">  637</span>    )</div>
<div class="line"><span class="lineno">  638</span> </div>
<div class="line"><span class="lineno">  639</span>    <span class="comment"># 👇 Aquí es donde agregamos la lógica que faltaba:</span></div>
<div class="line"><span class="lineno">  640</span>    cantidad_destacadas = sum(1 <span class="keywordflow">for</span> pub <span class="keywordflow">in</span> publicaciones <span class="keywordflow">if</span> pub.destacada == <span class="stringliteral">&quot;si&quot;</span>)</div>
<div class="line"><span class="lineno">  641</span> </div>
<div class="line"><span class="lineno">  642</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  643</span>        <span class="stringliteral">&#39;mis_publicaciones.html&#39;</span>,</div>
<div class="line"><span class="lineno">  644</span>        publicaciones=publicaciones,</div>
<div class="line"><span class="lineno">  645</span>        categorias=categorias,</div>
<div class="line"><span class="lineno">  646</span>        subcategorias=subcategorias,</div>
<div class="line"><span class="lineno">  647</span>        publicacion=<span class="keywordtype">None</span>,</div>
<div class="line"><span class="lineno">  648</span>        tiene_publicaciones=tiene_publicaciones,</div>
<div class="line"><span class="lineno">  649</span>        cantidad_actual=conteo[<span class="stringliteral">&quot;cantidad_actual&quot;</span>],</div>
<div class="line"><span class="lineno">  650</span>        limite_maximo=conteo[<span class="stringliteral">&quot;limite_maximo&quot;</span>],</div>
<div class="line"><span class="lineno">  651</span>        cantidad_destacadas=cantidad_destacadas,</div>
<div class="line"><span class="lineno">  652</span>        slots_vacios=conteo[<span class="stringliteral">&quot;slots_vacios&quot;</span>]  <span class="comment"># 👈 Ahora sí se pasa al template</span></div>
<div class="line"><span class="lineno">  653</span>    )</div>
<div class="line"><span class="lineno">  654</span> </div>
<div class="line"><span class="lineno">  655</span> </div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span><span class="comment"># Guardar o actualizar publicación</span></div>
<div class="line"><span class="lineno">  658</span><span class="preprocessor">@web.route(&#39;/mis-publicaciones/guardar&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a786cfa2babdf5f350d193970ca00f2db" name="a786cfa2babdf5f350d193970ca00f2db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a786cfa2babdf5f350d193970ca00f2db">&#9670;&#160;</a></span>obtener_promocion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.obtener_promocion </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00765">765</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  765</span><span class="keyword">def </span>obtener_promocion():</div>
<div class="line"><span class="lineno">  766</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  767</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  768</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para continuar&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  769</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.login&#39;</span>))</div>
<div class="line"><span class="lineno">  770</span> </div>
<div class="line"><span class="lineno">  771</span>    <span class="comment"># Validar si ya hay otra destacada</span></div>
<div class="line"><span class="lineno">  772</span>    ya_destacada = Publicaciones.query.filter(</div>
<div class="line"><span class="lineno">  773</span>        Publicaciones.usuario_id == usuario_id,</div>
<div class="line"><span class="lineno">  774</span>        Publicaciones.destacada == <span class="stringliteral">&quot;si&quot;</span></div>
<div class="line"><span class="lineno">  775</span>    ).first()</div>
<div class="line"><span class="lineno">  776</span> </div>
<div class="line"><span class="lineno">  777</span>    <span class="keywordflow">if</span> ya_destacada:</div>
<div class="line"><span class="lineno">  778</span>        flash(<span class="stringliteral">&quot;Ya tienes una publicación destacada. No puedes promocionar otra.&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  779</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  780</span> </div>
<div class="line"><span class="lineno">  781</span>    <span class="comment"># Crear preferencia en Mercado Pago</span></div>
<div class="line"><span class="lineno">  782</span>    url = crear_preferencia_pago(</div>
<div class="line"><span class="lineno">  783</span>        titulo=f<span class="stringliteral">&quot;Promoción de tu publicación&quot;</span>,</div>
<div class="line"><span class="lineno">  784</span>        precio=10000,</div>
<div class="line"><span class="lineno">  785</span>        cantidad=1,</div>
<div class="line"><span class="lineno">  786</span>        email_comprador=<span class="stringliteral">&quot;test_user_5067314673306232306@testuser.com&quot;</span></div>
<div class="line"><span class="lineno">  787</span>    )</div>
<div class="line"><span class="lineno">  788</span> </div>
<div class="line"><span class="lineno">  789</span>    <span class="keywordflow">return</span> redirect(url)</div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span><span class="preprocessor">@web.route(&#39;/promocionar-publicacion/&lt;int:publicacion_id&gt;&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac87fcb9bb982bc89112dd28ba1e8b10a" name="ac87fcb9bb982bc89112dd28ba1e8b10a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac87fcb9bb982bc89112dd28ba1e8b10a">&#9670;&#160;</a></span>obtener_subcategorias()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.obtener_subcategorias </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>categoria_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00757">757</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  757</span><span class="keyword">def </span>obtener_subcategorias(categoria_id):</div>
<div class="line"><span class="lineno">  758</span>    subcategorias = Subcategorias.query.filter_by(categoria_id=categoria_id).all()</div>
<div class="line"><span class="lineno">  759</span>    data = [{<span class="stringliteral">&quot;id&quot;</span>: sub.subcategoria_id, <span class="stringliteral">&quot;nombre&quot;</span>: sub.nombre_subcategoria} <span class="keywordflow">for</span> sub <span class="keywordflow">in</span> subcategorias]</div>
<div class="line"><span class="lineno">  760</span>    <span class="keywordflow">return</span> jsonify(data)</div>
<div class="line"><span class="lineno">  761</span> </div>
<div class="line"><span class="lineno">  762</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aa2180aefeaff7c70fbed288e2207144f" name="aa2180aefeaff7c70fbed288e2207144f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2180aefeaff7c70fbed288e2207144f">&#9670;&#160;</a></span>perfil_cliente()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.perfil_cliente </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00313">313</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  313</span><span class="keyword">def </span>perfil_cliente():</div>
<div class="line"><span class="lineno">  314</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  316</span>        flash(auth_result.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  320</span>        form_tipo = request.form.get(<span class="stringliteral">&#39;form_tipo&#39;</span>)</div>
<div class="line"><span class="lineno">  321</span>        data = request.form.to_dict()</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>        <span class="keywordflow">if</span> form_tipo == <span class="stringliteral">&#39;foto_perfil&#39;</span>:</div>
<div class="line"><span class="lineno">  324</span>            file = request.files.get(<span class="stringliteral">&#39;foto&#39;</span>)</div>
<div class="line"><span class="lineno">  325</span>            resultado = subir_foto_perfil_service(file)</div>
<div class="line"><span class="lineno">  326</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  327</span>            campos_map = {</div>
<div class="line"><span class="lineno">  328</span>                <span class="stringliteral">&#39;perfil_principal&#39;</span>: [<span class="stringliteral">&#39;primer_nombre&#39;</span>, <span class="stringliteral">&#39;segundo_nombre&#39;</span>, <span class="stringliteral">&#39;primer_apellido&#39;</span>, <span class="stringliteral">&#39;segundo_apellido&#39;</span>, <span class="stringliteral">&#39;correo&#39;</span>],</div>
<div class="line"><span class="lineno">  329</span>                <span class="stringliteral">&#39;direccion&#39;</span>: [<span class="stringliteral">&#39;direccion&#39;</span>],</div>
<div class="line"><span class="lineno">  330</span>            }</div>
<div class="line"><span class="lineno">  331</span>            campos = campos_map.get(form_tipo)</div>
<div class="line"><span class="lineno">  332</span>            <span class="keywordflow">if</span> campos:</div>
<div class="line"><span class="lineno">  333</span>                resultado = actualizar_perfil_cliente_service(data, campos=campos)</div>
<div class="line"><span class="lineno">  334</span>            <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  335</span>                resultado = {<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: <span class="stringliteral">&quot;Formulario desconocido.&quot;</span>}</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>        flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;success&quot;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  338</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_cliente&#39;</span>))</div>
<div class="line"><span class="lineno">  339</span> </div>
<div class="line"><span class="lineno">  340</span>    <span class="comment"># GET</span></div>
<div class="line"><span class="lineno">  341</span>    datos = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">  342</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  343</span>        <span class="stringliteral">&#39;perfil_cliente.html&#39;</span>,</div>
<div class="line"><span class="lineno">  344</span>        primer_nombre=datos.get(<span class="stringliteral">&quot;primer_nombre&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  345</span>        segundo_nombre=(datos.get(<span class="stringliteral">&quot;segundo_nombre&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  346</span>        primer_apellido=datos.get(<span class="stringliteral">&quot;primer_apellido&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  347</span>        segundo_apellido=(datos.get(<span class="stringliteral">&quot;segundo_apellido&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  348</span>        direccion=(datos.get(<span class="stringliteral">&quot;direccion&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  349</span>        foto_perfil=datos.get(<span class="stringliteral">&quot;foto_perfil&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">  350</span>    )</div>
</div><!-- fragment -->
</div>
</div>
<a id="a5d4a67cf82c5a2a9d75434d1822b3fd5" name="a5d4a67cf82c5a2a9d75434d1822b3fd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d4a67cf82c5a2a9d75434d1822b3fd5">&#9670;&#160;</a></span>perfil_experto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.perfil_experto </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00361">361</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  361</span><span class="keyword">def </span>perfil_experto():</div>
<div class="line"><span class="lineno">  362</span>    <span class="comment"># Verificamos si el usuario está autenticado</span></div>
<div class="line"><span class="lineno">  363</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  364</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  365</span>        flash(auth_result.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  366</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  369</span>        form_tipo = (</div>
<div class="line"><span class="lineno">  370</span>            request.form.get(<span class="stringliteral">&#39;form_tipo1&#39;</span>) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  371</span>            request.form.get(<span class="stringliteral">&#39;form_tipo2&#39;</span>) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  372</span>            request.form.get(<span class="stringliteral">&#39;form_tipo3&#39;</span>) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  373</span>            request.form.get(<span class="stringliteral">&#39;form_tipo4&#39;</span>) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  374</span>            request.form.get(<span class="stringliteral">&#39;form_tipo5&#39;</span>) <span class="keywordflow">or</span></div>
<div class="line"><span class="lineno">  375</span>            request.form.get(<span class="stringliteral">&#39;form_tipo6&#39;</span>)</div>
<div class="line"><span class="lineno">  376</span>        )</div>
<div class="line"><span class="lineno">  377</span>        data = request.form.to_dict()</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>        <span class="keywordflow">if</span> form_tipo == <span class="stringliteral">&#39;perfil_principal2&#39;</span>:</div>
<div class="line"><span class="lineno">  380</span>            campos = [<span class="stringliteral">&#39;primer_nombre&#39;</span>, <span class="stringliteral">&#39;segundo_nombre&#39;</span>, <span class="stringliteral">&#39;primer_apellido&#39;</span>, <span class="stringliteral">&#39;segundo_apellido&#39;</span>]</div>
<div class="line"><span class="lineno">  381</span>            resultado = actualizar_perfil_experto_service(data, campos=campos)</div>
<div class="line"><span class="lineno">  382</span> </div>
<div class="line"><span class="lineno">  383</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;idioma&#39;</span>:</div>
<div class="line"><span class="lineno">  384</span>            campos = [<span class="stringliteral">&#39;nombre_idioma&#39;</span>]</div>
<div class="line"><span class="lineno">  385</span>            resultado = actualizar_perfil_experto_service2(data, campos=campos)</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;aptitud&#39;</span>:</div>
<div class="line"><span class="lineno">  388</span>            campos = [<span class="stringliteral">&#39;tipo_aptitud&#39;</span>]</div>
<div class="line"><span class="lineno">  389</span>            resultado = actualizar_perfil_experto_service3(data, campos=campos)</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;estudios&#39;</span>:</div>
<div class="line"><span class="lineno">  392</span>            campos = [<span class="stringliteral">&#39;institucion&#39;</span>, <span class="stringliteral">&#39;titulo_obtenido&#39;</span>, <span class="stringliteral">&#39;fecha_inicio&#39;</span>, <span class="stringliteral">&#39;fecha_fin&#39;</span>]</div>
<div class="line"><span class="lineno">  393</span>            resultado = actualizar_perfil_experto_service4(data, campos=campos)</div>
<div class="line"><span class="lineno">  394</span> </div>
<div class="line"><span class="lineno">  395</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;eliminar_idioma&#39;</span>:</div>
<div class="line"><span class="lineno">  396</span>            resultado = eliminar_idioma(data)</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;eliminar_aptitud&#39;</span>:</div>
<div class="line"><span class="lineno">  399</span>            resultado = eliminar_aptitud(data)</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;eliminar_estudios&#39;</span>:</div>
<div class="line"><span class="lineno">  402</span>            resultado = eliminar_estudios(data)</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;editar_estudios&#39;</span>:</div>
<div class="line"><span class="lineno">  405</span>            resultado = editar_estudios(data)</div>
<div class="line"><span class="lineno">  406</span> </div>
<div class="line"><span class="lineno">  407</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;experiencia&#39;</span>:</div>
<div class="line"><span class="lineno">  408</span>            resultado = actualizar_experiencia(data)</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;eliminar_experiencia&#39;</span>:</div>
<div class="line"><span class="lineno">  411</span>            resultado = eliminar_experiencia(data)</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;editar_experiencia&#39;</span>:</div>
<div class="line"><span class="lineno">  414</span>            resultado = editar_experiencia(data)</div>
<div class="line"><span class="lineno">  415</span> </div>
<div class="line"><span class="lineno">  416</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;perfil_principal3&#39;</span>:</div>
<div class="line"><span class="lineno">  417</span>            resultado = actualizar_perfil_experto_service5(data)</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;eliminar_descripcion&#39;</span>:</div>
<div class="line"><span class="lineno">  420</span>            resultado = eliminar_descripcion(data)</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;editar_descripcion&#39;</span>:</div>
<div class="line"><span class="lineno">  423</span>            resultado = editar_descripcion(data)</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>        <span class="keywordflow">elif</span> form_tipo == <span class="stringliteral">&#39;foto_perfil&#39;</span>:</div>
<div class="line"><span class="lineno">  426</span>            file = request.files.get(<span class="stringliteral">&#39;foto&#39;</span>)</div>
<div class="line"><span class="lineno">  427</span>            resultado = subir_foto_perfil_service_experto(file)</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  430</span>            resultado = {<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: <span class="stringliteral">&quot;Formulario desconocido.&quot;</span>}</div>
<div class="line"><span class="lineno">  431</span> </div>
<div class="line"><span class="lineno">  432</span>        categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">  433</span>        flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error al actualizar perfil.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  434</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_experto&#39;</span>))</div>
<div class="line"><span class="lineno">  435</span> </div>
<div class="line"><span class="lineno">  436</span>    <span class="comment"># GET: cargar datos para mostrar en plantilla</span></div>
<div class="line"><span class="lineno">  437</span>    resultado = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">  438</span>    id_perfil = resultado.get(<span class="stringliteral">&quot;id_perfil&quot;</span>, <span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><span class="lineno">  439</span>    idiomas = obtener_idiomas_perfil()</div>
<div class="line"><span class="lineno">  440</span>    aptitudes = obtener_aptitudes_perfil(id_perfil)  <span class="comment"># ✅ AÑADIDO: obtener lista de aptitudes del perfil</span></div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  443</span>        <span class="stringliteral">&#39;perfil_experto.html&#39;</span>,</div>
<div class="line"><span class="lineno">  444</span>        id_perfil=id_perfil,</div>
<div class="line"><span class="lineno">  445</span>        primer_nombre=resultado.get(<span class="stringliteral">&quot;primer_nombre&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  446</span>        segundo_nombre=(resultado.get(<span class="stringliteral">&quot;segundo_nombre&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  447</span>        primer_apellido=resultado.get(<span class="stringliteral">&quot;primer_apellido&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  448</span>        segundo_apellido=(resultado.get(<span class="stringliteral">&quot;segundo_apellido&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  449</span>        descripcion_perfil=(resultado.get(<span class="stringliteral">&quot;descripcion_perfil&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  450</span>        nombre_idioma=(resultado.get(<span class="stringliteral">&quot;nombre_idioma&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  451</span>        tipo_aptitud=(resultado.get(<span class="stringliteral">&quot;tipo_aptitud&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  452</span>        institucion=(resultado.get(<span class="stringliteral">&quot;institucion&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  453</span>        titulo_obtenido=(resultado.get(<span class="stringliteral">&quot;titulo_obtenido&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  454</span>        fecha_inicio=resultado.get(<span class="stringliteral">&quot;fecha_inicio&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">  455</span>        fecha_fin=resultado.get(<span class="stringliteral">&quot;fecha_fin&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">  456</span>        nombre_experiencia=(resultado.get(<span class="stringliteral">&quot;nombre&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  457</span>        descripcion_experiencia=(resultado.get(<span class="stringliteral">&quot;descripcion&quot;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&quot;&quot;</span>).title(),</div>
<div class="line"><span class="lineno">  458</span>        fecha_inicio_experiencia=resultado.get(<span class="stringliteral">&quot;fecha_inicio_experiencia&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">  459</span>        fecha_fin_experiencia=resultado.get(<span class="stringliteral">&quot;fecha_fin_experiencia&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">  460</span>        foto_perfil=resultado.get(<span class="stringliteral">&quot;foto_perfil&quot;</span>, <span class="stringliteral">&quot;&quot;</span>),</div>
<div class="line"><span class="lineno">  461</span>        idiomas=idiomas,</div>
<div class="line"><span class="lineno">  462</span>        aptitudes=aptitudes  <span class="comment">#  AÑADIDO: pasar la lista de aptitudes al HTML</span></div>
<div class="line"><span class="lineno">  463</span>    )</div>
<div class="line"><span class="lineno">  464</span>        </div>
<div class="line"><span class="lineno">  465</span><span class="stringliteral">&quot;&quot;&quot;# Ruta para visualizar el chat</span></div>
<div class="line"><span class="lineno">  466</span><span class="stringliteral">@web.route(&#39;/mensajeria.html&#39;)</span></div>
<div class="line"><span class="lineno">  467</span><span class="stringliteral">@login_required</span></div>
<div class="line"><span class="lineno">  468</span><span class="stringliteral">def mensajeria():</span></div>
<div class="line"><span class="lineno">  469</span><span class="stringliteral">    return redirect(url_for(&#39;mensajeria.mensajeria&#39;))&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span><span class="comment"># Ruta para la sección de guardados (requiere sesión)</span></div>
<div class="line"><span class="lineno">  472</span><span class="preprocessor">@web.route(&#39;/guardar-publicacion/&lt;int:publicacion_id&gt;&#39;, methods=[&#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e58aa6de3c2bbfd3b25ece18fcc68f6" name="a7e58aa6de3c2bbfd3b25ece18fcc68f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e58aa6de3c2bbfd3b25ece18fcc68f6">&#9670;&#160;</a></span>perfil_experto_publico()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.perfil_experto_publico </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>usuario_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00558">558</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  558</span><span class="keyword">def </span>perfil_experto_publico(usuario_id):</div>
<div class="line"><span class="lineno">  559</span>    experto = Usuario.query.get(usuario_id)</div>
<div class="line"><span class="lineno">  560</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> experto:</div>
<div class="line"><span class="lineno">  561</span>        flash(<span class="stringliteral">&quot;No se encontró el usuario.&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  562</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  563</span> </div>
<div class="line"><span class="lineno">  564</span>    perfil = obtener_perfil_publico_service(usuario_id)</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>    <span class="comment"># Si tu modelo Usuario no tiene las relaciones directas y las maneja el modelo &#39;perfiles&#39;, puedes acceder desde perfil</span></div>
<div class="line"><span class="lineno">  567</span>    experiencias = perfil.experiencias <span class="keywordflow">if</span> perfil <span class="keywordflow">else</span> []</div>
<div class="line"><span class="lineno">  568</span>    idiomas = perfil.idioma <span class="keywordflow">if</span> perfil <span class="keywordflow">else</span> []</div>
<div class="line"><span class="lineno">  569</span>    aptitudes = perfil.aptitudes <span class="keywordflow">if</span> perfil <span class="keywordflow">else</span> []</div>
<div class="line"><span class="lineno">  570</span>    descripcion_perfil = perfil.descripcion_perfil <span class="keywordflow">if</span> perfil <span class="keywordflow">else</span> []</div>
<div class="line"><span class="lineno">  571</span>    estudios = perfil.estudios <span class="keywordflow">if</span> perfil <span class="keywordflow">else</span> []</div>
<div class="line"><span class="lineno">  572</span> </div>
<div class="line"><span class="lineno">  573</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  574</span>        <span class="stringliteral">&#39;perfil_experto_publico.html&#39;</span>,</div>
<div class="line"><span class="lineno">  575</span>        experto=experto,</div>
<div class="line"><span class="lineno">  576</span>        perfil=perfil,</div>
<div class="line"><span class="lineno">  577</span>        experiencias=experiencias,</div>
<div class="line"><span class="lineno">  578</span>        idiomas=idiomas,</div>
<div class="line"><span class="lineno">  579</span>        aptitudes=aptitudes,</div>
<div class="line"><span class="lineno">  580</span>        descripcion_perfil=descripcion_perfil,</div>
<div class="line"><span class="lineno">  581</span>        estudios=estudios,</div>
<div class="line"><span class="lineno">  582</span>    )</div>
<div class="line"><span class="lineno">  583</span> </div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span> </div>
<div class="line"><span class="lineno">  588</span> </div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf57460241109a2cf3e0f6f48faf313a" name="aaf57460241109a2cf3e0f6f48faf313a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf57460241109a2cf3e0f6f48faf313a">&#9670;&#160;</a></span>perfil_foto()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.perfil_foto </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>filename</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00354">354</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  354</span><span class="keyword">def </span>perfil_foto(filename):</div>
<div class="line"><span class="lineno">  355</span>    carpeta = os.path.join(current_app.root_path, <span class="stringliteral">&#39;static&#39;</span>, <span class="stringliteral">&#39;uploads&#39;</span>, <span class="stringliteral">&#39;perfiles&#39;</span>)</div>
<div class="line"><span class="lineno">  356</span>    safe_filename = secure_filename(filename)</div>
<div class="line"><span class="lineno">  357</span>    <span class="keywordflow">return</span> send_from_directory(carpeta, safe_filename)</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span><span class="comment"># Ruta para visualizar el perfil del experto</span></div>
<div class="line"><span class="lineno">  360</span><span class="preprocessor">@web.route(&#39;/perfil_experto&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1a416b1122a2929cc5fa43068dfc792" name="aa1a416b1122a2929cc5fa43068dfc792"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1a416b1122a2929cc5fa43068dfc792">&#9670;&#160;</a></span>perfil_general()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.perfil_general </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00531">531</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  531</span><span class="keyword">def </span>perfil_general():</div>
<div class="line"><span class="lineno">  532</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  533</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  534</span>        flash(auth_result.get(<span class="stringliteral">&quot;message&quot;</span>), <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))</div>
<div class="line"><span class="lineno">  536</span> </div>
<div class="line"><span class="lineno">  537</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  538</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  539</span>        flash(<span class="stringliteral">&quot;No se pudo identificar al usuario.&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  540</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>    usuario = Usuario.query.get(usuario_id)</div>
<div class="line"><span class="lineno">  543</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario:</div>
<div class="line"><span class="lineno">  544</span>        flash(<span class="stringliteral">&quot;Usuario no encontrado.&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  545</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  546</span> </div>
<div class="line"><span class="lineno">  547</span>    <span class="keywordflow">if</span> usuario.id_rol == 2:</div>
<div class="line"><span class="lineno">  548</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_cliente&#39;</span>))</div>
<div class="line"><span class="lineno">  549</span>    <span class="keywordflow">elif</span> usuario.id_rol == 1:</div>
<div class="line"><span class="lineno">  550</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.perfil_experto&#39;</span>))</div>
<div class="line"><span class="lineno">  551</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  552</span>        flash(<span class="stringliteral">&quot;Rol no reconocido.&quot;</span>, <span class="stringliteral">&quot;error&quot;</span>)</div>
<div class="line"><span class="lineno">  553</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">  554</span> </div>
<div class="line"><span class="lineno">  555</span> </div>
<div class="line"><span class="lineno">  556</span><span class="comment">#perfil general</span></div>
<div class="line"><span class="lineno">  557</span><span class="preprocessor">@web.route(&#39;/perfil-experto/&lt;int:usuario_id&gt;&#39;)</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a716597e79ee52043355538634cf56c0d" name="a716597e79ee52043355538634cf56c0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a716597e79ee52043355538634cf56c0d">&#9670;&#160;</a></span>promocionar_publicacion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.promocionar_publicacion </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>publicacion_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00792">792</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  792</span><span class="keyword">def </span>promocionar_publicacion(publicacion_id):</div>
<div class="line"><span class="lineno">  793</span>    usuario_id = obtener_usuario_id_autenticado()</div>
<div class="line"><span class="lineno">  794</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario_id:</div>
<div class="line"><span class="lineno">  795</span>        flash(<span class="stringliteral">&quot;Debes iniciar sesión para continuar&quot;</span>, <span class="stringliteral">&quot;warning&quot;</span>)</div>
<div class="line"><span class="lineno">  796</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.login&#39;</span>))</div>
<div class="line"><span class="lineno">  797</span> </div>
<div class="line"><span class="lineno">  798</span>    <span class="comment"># Verificar que la publicación existe y pertenece al usuario</span></div>
<div class="line"><span class="lineno">  799</span>    publicacion = Publicaciones.query.get(publicacion_id)</div>
<div class="line"><span class="lineno">  800</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> publicacion <span class="keywordflow">or</span> publicacion.usuario_id != usuario_id:</div>
<div class="line"><span class="lineno">  801</span>        flash(<span class="stringliteral">&quot;No puedes promocionar esta publicación.&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  802</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>    <span class="comment"># Validar que no haya otra destacada</span></div>
<div class="line"><span class="lineno">  805</span>    ya_destacada = Publicaciones.query.filter(</div>
<div class="line"><span class="lineno">  806</span>        Publicaciones.usuario_id == usuario_id,</div>
<div class="line"><span class="lineno">  807</span>        Publicaciones.destacada == <span class="stringliteral">&quot;si&quot;</span></div>
<div class="line"><span class="lineno">  808</span>    ).first()</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>    <span class="keywordflow">if</span> ya_destacada:</div>
<div class="line"><span class="lineno">  811</span>        flash(<span class="stringliteral">&quot;Ya tienes una publicación destacada. No puedes promocionar otra.&quot;</span>, <span class="stringliteral">&quot;danger&quot;</span>)</div>
<div class="line"><span class="lineno">  812</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.mis_publicaciones&#39;</span>))</div>
<div class="line"><span class="lineno">  813</span> </div>
<div class="line"><span class="lineno">  814</span>    <span class="comment"># Crear preferencia en Mercado Pago</span></div>
<div class="line"><span class="lineno">  815</span>    url = crear_preferencia_pago(</div>
<div class="line"><span class="lineno">  816</span>        titulo=f<span class="stringliteral">&quot;Promoción de tu publicación: {publicacion.titulo}&quot;</span>,</div>
<div class="line"><span class="lineno">  817</span>        precio=10000,</div>
<div class="line"><span class="lineno">  818</span>        cantidad=1,</div>
<div class="line"><span class="lineno">  819</span>        email_comprador=<span class="stringliteral">&quot;test_user_5067314673306232306@testuser.com&quot;</span></div>
<div class="line"><span class="lineno">  820</span>    )</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>    <span class="comment"># Guardar en sesión el ID de la publicación que está en promoción</span></div>
<div class="line"><span class="lineno">  823</span>    session[<span class="stringliteral">&quot;promo_publicacion_id&quot;</span>] = publicacion_id</div>
<div class="line"><span class="lineno">  824</span> </div>
<div class="line"><span class="lineno">  825</span>    <span class="keywordflow">return</span> redirect(url)</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span> </div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a8785dfd9c0e0a347563626676490cf57" name="a8785dfd9c0e0a347563626676490cf57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8785dfd9c0e0a347563626676490cf57">&#9670;&#160;</a></span>publicaciones()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.publicaciones </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00257">257</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  257</span><span class="keyword">def </span>publicaciones():</div>
<div class="line"><span class="lineno">  258</span>    categoria_id = request.args.get(<span class="stringliteral">&#39;categoria_id&#39;</span>, type=int)</div>
<div class="line"><span class="lineno">  259</span>    subcategoria_id = request.args.get(<span class="stringliteral">&#39;subcategoria_id&#39;</span>, type=int)</div>
<div class="line"><span class="lineno">  260</span>    tiempo = request.args.get(<span class="stringliteral">&#39;tiempo&#39;</span>)  <span class="comment"># Puede ser &#39;24h&#39;, &#39;semana&#39;, &#39;mes&#39;, etc.</span></div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>    <span class="comment"># Obtener todas las categorías para los filtros</span></div>
<div class="line"><span class="lineno">  263</span>    categorias = Categorias.query.all()</div>
<div class="line"><span class="lineno">  264</span>    publicaciones_query = Publicaciones.query</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>    <span class="comment"># Base query</span></div>
<div class="line"><span class="lineno">  267</span>    publicaciones_query = Publicaciones.query</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">if</span> categoria_id:</div>
<div class="line"><span class="lineno">  270</span>        publicaciones_query = publicaciones_query.filter_by(categoria_id=categoria_id)</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    <span class="keywordflow">if</span> subcategoria_id:</div>
<div class="line"><span class="lineno">  273</span>        publicaciones_query = publicaciones_query.filter_by(subcategoria_id=subcategoria_id)</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>    <span class="comment"># Filtro por tiempo</span></div>
<div class="line"><span class="lineno">  276</span>    <span class="keywordflow">if</span> tiempo == <span class="stringliteral">&quot;24h&quot;</span>:</div>
<div class="line"><span class="lineno">  277</span>        desde = datetime.now() - timedelta(hours=24)</div>
<div class="line"><span class="lineno">  278</span>        publicaciones_query = publicaciones_query.filter(Publicaciones.fecha &gt;= desde)</div>
<div class="line"><span class="lineno">  279</span>    <span class="keywordflow">elif</span> tiempo == <span class="stringliteral">&quot;semana&quot;</span>:</div>
<div class="line"><span class="lineno">  280</span>        desde = datetime.now() - timedelta(days=7)</div>
<div class="line"><span class="lineno">  281</span>        publicaciones_query = publicaciones_query.filter(Publicaciones.fecha &gt;= desde)</div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">elif</span> tiempo == <span class="stringliteral">&quot;mes&quot;</span>:</div>
<div class="line"><span class="lineno">  283</span>        desde = datetime.now() - timedelta(days=30)</div>
<div class="line"><span class="lineno">  284</span>        publicaciones_query = publicaciones_query.filter(Publicaciones.fecha &gt;= desde)</div>
<div class="line"><span class="lineno">  285</span> </div>
<div class="line"><span class="lineno">  286</span>    <span class="comment"># Ordenar de más reciente a más antigua</span></div>
<div class="line"><span class="lineno">  287</span>    publicaciones = publicaciones_query.filter_by(estado = <span class="stringliteral">&quot;activo&quot;</span>).order_by(Publicaciones.fecha.desc()).all()</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>     <span class="comment"># Usuario logueado</span></div>
<div class="line"><span class="lineno">  290</span>    auth_result = verificar_autenticacion_service()</div>
<div class="line"><span class="lineno">  291</span>    id_usuario_logueado = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  292</span>    publicaciones_guardadas_ids = []</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordflow">if</span> auth_result.get(<span class="stringliteral">&quot;authenticated&quot;</span>):</div>
<div class="line"><span class="lineno">  295</span>        datos_usuario = obtener_datos_usuario_service()</div>
<div class="line"><span class="lineno">  296</span>        id_usuario_logueado = datos_usuario.get(<span class="stringliteral">&quot;usuario_id&quot;</span>)</div>
<div class="line"><span class="lineno">  297</span>        publicaciones_guardadas = obtener_guardados_service()</div>
<div class="line"><span class="lineno">  298</span>        publicaciones_guardadas_ids = [p.publicacion_id <span class="keywordflow">for</span> p <span class="keywordflow">in</span> publicaciones_guardadas]</div>
<div class="line"><span class="lineno">  299</span> </div>
<div class="line"><span class="lineno">  300</span>    <span class="keywordflow">return</span> render_template(</div>
<div class="line"><span class="lineno">  301</span>        <span class="stringliteral">&#39;publicaciones.html&#39;</span>,</div>
<div class="line"><span class="lineno">  302</span>        publicaciones_generales=publicaciones,</div>
<div class="line"><span class="lineno">  303</span>        categorias=categorias,</div>
<div class="line"><span class="lineno">  304</span>        total_resultados=len(publicaciones),</div>
<div class="line"><span class="lineno">  305</span>        categoria_seleccionada=categoria_id,</div>
<div class="line"><span class="lineno">  306</span>        id_usuario_logueado=id_usuario_logueado,</div>
<div class="line"><span class="lineno">  307</span>        publicaciones_guardadas_ids=publicaciones_guardadas_ids  <span class="comment"># 👈 importante</span></div>
<div class="line"><span class="lineno">  308</span>    )</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span><span class="comment"># Ruta para perfil cliente</span></div>
<div class="line"><span class="lineno">  312</span><span class="preprocessor">@web.route(&#39;/perfil_cliente&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8af600731d489cfbdbf4ae4c0b09eb9" name="aa8af600731d489cfbdbf4ae4c0b09eb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8af600731d489cfbdbf4ae4c0b09eb9">&#9670;&#160;</a></span>recuperar_contraseña()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.recuperar_contraseña </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00211">211</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  211</span><span class="keyword">def </span>recuperar_contraseña():</div>
<div class="line"><span class="lineno">  212</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  213</span>        correo = request.form.get(<span class="stringliteral">&#39;correo&#39;</span>)</div>
<div class="line"><span class="lineno">  214</span>        </div>
<div class="line"><span class="lineno">  215</span>        resultado = enviar_link_recuperacion_service(correo)</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>        categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">  218</span>        flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error inesperado.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>        <span class="comment"># Después de procesar, volvemos a mostrar el formulario</span></div>
<div class="line"><span class="lineno">  221</span>        <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.recuperar_contraseña&#39;</span>))</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    <span class="comment"># Si es GET, simplemente mostramos el formulario vacío</span></div>
<div class="line"><span class="lineno">  224</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;recuperar_contraseña.html&#39;</span>)</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span><span class="comment"># Ruta para restablecer la contraseña</span></div>
<div class="line"><span class="lineno">  228</span><span class="comment"># Esta ruta se activa al hacer clic en el enlace enviado al correo</span></div>
<div class="line"><span class="lineno">  229</span><span class="preprocessor">@web.route(&#39;/restablecer_contraseña/&lt;token&gt;&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a674c23b112a05ba0fe27159584a71756" name="a674c23b112a05ba0fe27159584a71756"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a674c23b112a05ba0fe27159584a71756">&#9670;&#160;</a></span>registrarse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.registrarse </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00077">77</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   77</span><span class="keyword">def </span>registrarse():</div>
<div class="line"><span class="lineno">   78</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">   79</span>        data = request.form.to_dict()</div>
<div class="line"><span class="lineno">   80</span>        resultado = registrar_usuario_service(data)</div>
<div class="line"><span class="lineno">   81</span> </div>
<div class="line"><span class="lineno">   82</span>        <span class="comment"># Asegurar que la clave &#39;success&#39; existe y es booleana</span></div>
<div class="line"><span class="lineno">   83</span>        categoria = <span class="stringliteral">&#39;success&#39;</span> <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>) <span class="keywordflow">else</span> <span class="stringliteral">&#39;error&#39;</span></div>
<div class="line"><span class="lineno">   84</span>        flash(resultado.get(<span class="stringliteral">&quot;message&quot;</span>, <span class="stringliteral">&quot;Error inesperado.&quot;</span>), categoria)</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">if</span> resultado.get(<span class="stringliteral">&quot;success&quot;</span>):</div>
<div class="line"><span class="lineno">   87</span>            <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.inicio&#39;</span>))</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;registrar_usuario.html&#39;</span>)</div>
<div class="line"><span class="lineno">   90</span> </div>
<div class="line"><span class="lineno">   91</span><span class="comment"># Ruta para iniciar sesión (Formulario web)</span></div>
<div class="line"><span class="lineno">   92</span><span class="preprocessor">@web.route(&#39;/iniciar_sesion&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad4099408206ff7d18558c5c73540b32b" name="ad4099408206ff7d18558c5c73540b32b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4099408206ff7d18558c5c73540b32b">&#9670;&#160;</a></span>restablecer_contraseña()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.restablecer_contraseña </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>token</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00230">230</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  230</span><span class="keyword">def </span>restablecer_contraseña(token):</div>
<div class="line"><span class="lineno">  231</span>    <span class="keywordflow">if</span> request.method == <span class="stringliteral">&#39;POST&#39;</span>:</div>
<div class="line"><span class="lineno">  232</span>        nueva_contraseña = request.form.get(<span class="stringliteral">&#39;contraseña&#39;</span>)</div>
<div class="line"><span class="lineno">  233</span>        confirmar_contraseña = request.form.get(<span class="stringliteral">&#39;contraseña2&#39;</span>)</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>        <span class="comment"># Preparamos el diccionario que espera la función service</span></div>
<div class="line"><span class="lineno">  236</span>        data = {</div>
<div class="line"><span class="lineno">  237</span>            <span class="stringliteral">&quot;token&quot;</span>: token,</div>
<div class="line"><span class="lineno">  238</span>            <span class="stringliteral">&quot;nueva_contraseña&quot;</span>: nueva_contraseña,</div>
<div class="line"><span class="lineno">  239</span>            <span class="stringliteral">&quot;confirmar_contraseña&quot;</span>: confirmar_contraseña</div>
<div class="line"><span class="lineno">  240</span>        }</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>        resultado = restablecer_contraseña_service(data)</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        <span class="keywordflow">if</span> resultado[<span class="stringliteral">&#39;success&#39;</span>]:</div>
<div class="line"><span class="lineno">  245</span>            flash(resultado[<span class="stringliteral">&#39;message&#39;</span>], <span class="stringliteral">&#39;success&#39;</span>)</div>
<div class="line"><span class="lineno">  246</span>            <span class="keywordflow">return</span> redirect(url_for(<span class="stringliteral">&#39;web.iniciar_sesion&#39;</span>))  <span class="comment"># O redirige donde prefieras</span></div>
<div class="line"><span class="lineno">  247</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  248</span>            flash(resultado[<span class="stringliteral">&#39;message&#39;</span>], <span class="stringliteral">&#39;error&#39;</span>)</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    <span class="keywordflow">return</span> render_template(<span class="stringliteral">&#39;cambiar_contraseña.html&#39;</span>)</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span><span class="comment"># Ruta para publicaciones generales interfaz</span></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0228dc7ce803b6703a75bc99f9051641" name="a0228dc7ce803b6703a75bc99f9051641"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0228dc7ce803b6703a75bc99f9051641">&#9670;&#160;</a></span>validar_contrasena_ajax()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.validar_contrasena_ajax </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00187">187</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  187</span><span class="keyword">def </span>validar_contrasena_ajax():</div>
<div class="line"><span class="lineno">  188</span>    data = request.get_json()</div>
<div class="line"><span class="lineno">  189</span>    contrasena = data.get(<span class="stringliteral">&quot;contrasena&quot;</span>)</div>
<div class="line"><span class="lineno">  190</span>    token = session.get(<span class="stringliteral">&#39;jwt&#39;</span>)</div>
<div class="line"><span class="lineno">  191</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> token:</div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordflow">return</span> jsonify({<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: <span class="stringliteral">&quot;No estás autenticado.&quot;</span>}), 401</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>    resultado_token = verificar_token(token)</div>
<div class="line"><span class="lineno">  195</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> resultado_token[<span class="stringliteral">&quot;valid&quot;</span>]:</div>
<div class="line"><span class="lineno">  196</span>        <span class="keywordflow">return</span> jsonify({<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: resultado_token[<span class="stringliteral">&quot;message&quot;</span>]}), 401</div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>    usuario = Usuario.query.get(resultado_token[<span class="stringliteral">&quot;payload&quot;</span>].get(<span class="stringliteral">&#39;usuario_id&#39;</span>))</div>
<div class="line"><span class="lineno">  199</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> usuario:</div>
<div class="line"><span class="lineno">  200</span>        <span class="keywordflow">return</span> jsonify({<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: <span class="stringliteral">&quot;Usuario no encontrado.&quot;</span>}), 404</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> check_password_hash(usuario.contrasena, contrasena):</div>
<div class="line"><span class="lineno">  203</span>        <span class="keywordflow">return</span> jsonify({<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">False</span>, <span class="stringliteral">&quot;message&quot;</span>: <span class="stringliteral">&quot;La contraseña es incorrecta.&quot;</span>}), 403</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>    <span class="keywordflow">return</span> jsonify({<span class="stringliteral">&quot;success&quot;</span>: <span class="keyword">True</span>})</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span><span class="comment"># Ruta para enviar el enlace de recuperación de contraseña</span></div>
<div class="line"><span class="lineno">  209</span><span class="comment"># Esta ruta se activa al enviar el formulario de recuperación</span></div>
<div class="line"><span class="lineno">  210</span><span class="preprocessor">@web.route(&#39;/recuperar_contraseña&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])</span></div>
</div><!-- fragment -->
</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Documentación de variables</h2>
<a id="ab295390199450310c31d57559261d172" name="ab295390199450310c31d57559261d172"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab295390199450310c31d57559261d172">&#9670;&#160;</a></span>web</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">app.routes.web.web = Blueprint('web', __name__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definición en la línea <a class="el" href="web_8py_source.html#l00029">29</a> del archivo <a class="el" href="web_8py_source.html">web.py</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespaceapp.html">app</a></li><li class="navelem"><a href="namespaceapp_1_1routes.html">routes</a></li><li class="navelem"><a href="namespaceapp_1_1routes_1_1web.html">web</a></li>
    <li class="footer">Generado por <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
