<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mis Publicaciones</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h1 class="mb-4">Mis Publicaciones</h1>

    <!-- Formulario: crear / editar -->
    <div class="card mb-4">
      <div class="card-header">
        {% if publicacion %}
          Editar Publicación
        {% else %}
          Nueva Publicación
        {% endif %}
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('web.guardar_mi_publicacion') }}">
          {% if publicacion %}
            <input type="hidden" name="publicacion_id" value="{{ publicacion.publicacion_id }}">
          {% endif %}

          <div class="mb-3">
            <label class="form-label">Título</label>
            <input type="text" class="form-control" name="titulo" value="{{ publicacion.titulo if publicacion else '' }}" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Precio</label>
            <input type="number" class="form-control" name="precio" step="0.01" value="{{ publicacion.precio if publicacion else '' }}">
          </div>

          <div class="mb-3">
            <label class="form-label">Categoría</label>
            <select class="form-select" name="categoria_id">
              <option value="">Seleccione</option>
              {% for cat in categorias %}
                <option value="{{ cat.categoria_id }}" {% if publicacion and publicacion.categoria_id == cat.categoria_id %}selected{% endif %}>{{ cat.tipo_categoria }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Subcategoría</label>
            <select class="form-select" name="subcategoria_id">
              <option value="">Seleccione</option>
              {% for sub in subcategorias %}
                <option value="{{ sub.subcategoria_id }}" {% if publicacion and publicacion.subcategoria_id == sub.subcategoria_id %}selected{% endif %}>{{ sub.nombre_subcategoria }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">Descripción</label>
            <textarea class="form-control" name="descripcion_publicacion">{{ publicacion.descripcion_publicacion if publicacion else '' }}</textarea>
          </div>

          <button type="submit" class="btn btn-primary">
            {% if publicacion %}Actualizar{% else %}Guardar{% endif %}
          </button>
          <a href="{{ url_for('web.mis_publicaciones') }}" class="btn btn-secondary">Cancelar</a>
        </form>
      </div>
    </div>

    <!-- Tabla -->
    <div class="card">
      <div class="card-header">Mis Publicaciones</div>
      <div class="card-body">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Precio</th>
              <th>Categoría</th>
              <th>Subcategoría</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for pub in publicaciones %}
              <tr>
                <td>{{ pub.publicacion_id }}</td>
                <td>{{ pub.titulo }}</td>
                <td>{{ pub.precio }}</td>
                <td>{{ pub.categoria.tipo_categoria if pub.categoria else '' }}</td>
                <td>{{ pub.subcategoria.nombre_subcategoria if pub.subcategoria else '' }}</td>
                <td>
                  <a href="{{ url_for('web.editar_mi_publicacion', publicacion_id=pub.publicacion_id) }}" class="btn btn-sm btn-warning">Editar</a>
                  <a href="{{ url_for('web.eliminar_mi_publicacion', publicacion_id=pub.publicacion_id) }}" class="btn btn-sm btn-danger" onclick="return confirm('¿Seguro que deseas eliminar?')">Eliminar</a>
                </td>
              </tr>
            {% else %}
              <tr>
                <td colspan="6" class="text-center">No tienes publicaciones aún.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</body>
</html>
