<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CaliTrabaja</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/inicio.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/modal_reportar.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="https://i.postimg.cc/26ZkKCPm/Vector.png">
</head>

<body>

  

  {% include 'nav.html' %}
  {% include 'errors.html' %}

  <!-- CONTENEDOR PADRE GENERAL -->
  <div class="main-container">

      {% if not session.get('jwt') %}
  <!-- ENCABEZADO PARA USUARIOS NO LOGUEADOS -->
  <div class="header-section no-login-header">
    <div class="titulo no-login-title">
      <p class="bienvenidos">BIENVENIDOS A</p>
      <p><span class="cali">CALI</span> TRABAJA</p>
    </div>
    <div class="app-icons">
      <p>Obtener aplicación</p>
      <div class="icons">
        <i class="bi bi-google-play"></i>
        <i class="bi bi-windows"></i>
      </div>
    </div>
  </div>
  {% else %}
  <!-- ENCABEZADO PARA USUARIOS LOGUEADOS -->
  <div class="header-section login-header">
    <div class="titulo login-title">
      <p>Hola, <span class="usuario">{{ primer_nombre }}</span></p>
    </div>
  </div>
  {% endif %}

    

    <!-- SLIDER DE FRASES -->
    <div class="carousel-container">
      <div id="carouselExampleInterval" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active" data-bs-interval="10000">
            <p class="frase">Nosotros conectamos, tú <span class="resaltado">decides.</span></p>
          </div>
          <div class="carousel-item" data-bs-interval="2000">
            <p class="frase">Conecta, trabaja, <span class="resaltado">crece.</span></p>
          </div>
          <div class="carousel-item">
            <p class="frase">Conectando habilidades para un futuro <span class="resaltado">mejor.</span></p>
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleInterval" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Siguiente</span>
        </button>
      </div>
    </div>

      <!-- CATEGORÍAS CON FLECHAS A LOS EXTREMOS -->
    <div class="titulo-categorias">
    Categorías
</div>

<div class="slider-categorias-contenedor">
    <button class="flecha izquierda" id="flechaIzq">
        <i class="bi bi-chevron-left"></i>
    </button>

<!-- Formulario oculto para enviar el ID de la categoría -->
<form id="filtroForm" method="GET" action="{{ url_for('web.publicaciones') }}">
  <input type="hidden" name="categoria_id" id="inputCategoria">
</form>

<!-- Slider de categorías -->
<div class="slider-categorias" id="sliderCategorias">
  <div class="categoria" data-categoria-id="1">
    <img src="../static/images/categorias/tecnico.svg" alt="Categoría 1">
    <p class="nombre-categoria">Reparación y mantenimiento</p>
  </div>
  <div class="categoria" data-categoria-id="2">
    <img src="../static/images/categorias/Cuidadoyasistencia.svg" alt="Categoría 2">
    <p class="nombre-categoria">Cuidado y asistencia</p>
  </div>
  <div class="categoria" data-categoria-id="3">
    <img src="../static/images/categorias/mascoteros.svg" alt="Categoría 3">
    <p class="nombre-categoria">Bienestar de mascotas</p>
  </div>
  <div class="categoria" data-categoria-id="4">
    <img src="../static/images/categorias/educativos.svg" alt="Categoría 4">
    <p class="nombre-categoria">Educativos y aprendizaje</p>
  </div>
  <div class="categoria" data-categoria-id="5">
    <img src="../static/images/categorias/limpieza.svg" alt="Categoría 5">
    <p class="nombre-categoria">Hogar y limpieza</p>
  </div>
  <div class="categoria" data-categoria-id="6">
    <img src="../static/images/categorias/Construccion.svg" alt="Categoría 6">
    <p class="nombre-categoria">Construcción y remodelación</p>
  </div>
  <div class="categoria" data-categoria-id="7">
    <img src="../static/images/categorias/artisticos.svg" alt="Categoría 7">
    <p class="nombre-categoria">Artísticos y creatividad visual</p>
  </div>
  <div class="categoria" data-categoria-id="8">
    <img src="../static/images/categorias/transporte.svg" alt="Categoría 8">
    <p class="nombre-categoria">Movilidad y transporte</p>
  </div>
  <div class="categoria" data-categoria-id="9">
    <img src="../static/images/categorias/culinarios.svg" alt="Categoría 9">
    <p class="nombre-categoria">Gastronomía</p>
  </div>
  <div class="categoria" data-categoria-id="10">
    <img src="../static/images/categorias/eventos.svg" alt="Categoría 10">
    <p class="nombre-categoria">Eventos</p>
  </div>
  <div class="categoria" data-categoria-id="11">
    <img src="../static/images/categorias/salud_bien.svg" alt="Categoría 11">
    <p class="nombre-categoria">Bienestar personal</p>
  </div>
</div>



    <button class="flecha derecha" id="flechaDer">
        <i class="bi bi-chevron-right"></i>
    </button>
</div>

{% include "modal_reportar.html" %}

<!-- Carrucel-->
<div class="contenedor">
  <h2 class="titulo-interes">Destacados para ti</h2>

  <div class="slider-container">
    <div class="slider" id="slider">

      <!-- Tarjeta 1 -->
       {% for pub in publicaciones_aleatorias %}
      <div class="card-tarjeta">
        <div class="image-price-container">
  
          {% if pub.usuario.perfiles.foto_perfil %}
            <img src="{{ url_for('web.perfil_foto', filename=pub.usuario.perfiles.foto_perfil) }}" alt="Foto de perfil" />
          {% endif %}
          <p class="price">COP {{ pub.precio }}</p>
          {% if pub.destacada == 'si' %}
            <p class="destacada">Promocionada</p>
          {% endif %}
        </div>

        <div class="card-content">
          <div class="header">
            <h3 class="nombre">{{ pub.usuario.perfiles.primer_nombre }} {{ pub.usuario.perfiles.primer_apellido }}</h3>

            <!-- Menú -->
            <div class="menu-button-container">
              <button class="menu-button">
                <i class="bi bi-three-dots"></i>
              </button>
              <div class="menu-completo">
                <span class="menu-close-btn" onclick="cerrarMenu(this)">x</span>

                <a href="{{ url_for('web.perfil_experto_publico', usuario_id=pub.usuario.usuario_id) }}" class="btn-link">
                  <i class="bi bi-person-fill"></i><span>Ver perfil</span>
                </a>
                <!-- Contenedor de mensajes dinámicos -->
        
                <a href="javascript:void(0);" class="guardar-btn" data-id="{{ pub.publicacion_id }}">
                  <i class="bi bi-bookmark-check"></i><span>Guardar</span>
                </a>
                <a href="javascript:void(0);" class="btn-link abrir-modal-reporte" data-publicacion-id="{{ pub.publicacion_id }}" data-usuario-reportado="{{ pub.usuario.usuario_id }}" data-usuario="{{ current_user.id }}">
                  <i class="bi bi-exclamation-circle"></i><span>Reportar</span>
                </a>
              </div>
            </div>
          <!----fin manu-->
          </div>

          <div class="estrellasTarjetas">
            <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
            <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
            <i class="bi bi-star-fill"></i>
          </div>
          <p class="profesion"><strong>{{ pub.titulo }}</strong></p>
          <p class="descripcion-titulo">Descripción:</p>
          <p class="descripcion descripcion-texto">
            {{ pub.descripcion_publicacion }}
          </p>
          <span class="ver-mas hidden">Ver más</span>

          <div class="boton-container">
            <button class="contact-button">Contactar experto</button>
          </div>
        </div>
      </div> <!-- fin tarjeta -->
      {% endfor %}



        
    </div> <!-- fin slider -->
  </div> <!-- fin slider-container -->
   <!-- Flechas -->
    <div class="arrows">
      <button class="arrow-btn" id="arrowPromosLeft">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#35A9AE" stroke-width="2.5" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 8 8 12 12 16" />
          <line x1="16" y1="12" x2="8" y2="12" />
        </svg>
      </button>
      
      <button class="arrow-btn" id="arrowPromosRight">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#35A9AE" stroke-width="2.5" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 8 16 12 12 16" />
          <line x1="8" y1="12" x2="16" y2="12" />
        </svg>
      </button>
    </div>

</div> <!-- fin contenedor -->




<!-- Carrucel SERVICIOS DESTACADOS -->
<div class="contenedor-destacados">
  <h2 class="titulo-interes">Servicios Recientes</h2>

  <div class="slider-container">
    <div class="slider" id="slider">


      <!-- Tarjeta 1 -->
      {% for pub in publicaciones_recientes %}
      <div class="card-tarjeta">
        <div class="image-price-container">
          {% if pub.usuario.perfiles.foto_perfil %}
            <img src="{{ url_for('web.perfil_foto', filename=pub.usuario.perfiles.foto_perfil) }}" alt="Foto de perfil" />
          {% endif %}

          <p class="price">COP {{ pub.precio }}/h</p>
        </div>

        <div class="card-content">
          <div class="header">
            <h3 class="nombre">{{ pub.usuario.perfiles.primer_nombre }} {{ pub.usuario.perfiles.primer_apellido }}</h3>

            <!-- Menú -->
            <div class="menu-button-container">
              <button class="menu-button">
                <i class="bi bi-three-dots"></i>
              </button>
              <div class="menu-completo">
                <span class="menu-close-btn" onclick="cerrarMenu(this)">x</span>
                <a href="{{ url_for('web.perfil_experto_publico', usuario_id=pub.usuario.usuario_id) }}" class="btn-link">
                  <i class="bi bi-person-fill"></i><span>Ver perfil</span>
                </a>
                <!-- Contenedor de mensajes dinámicos -->
        
                <a href="javascript:void(0);" class="guardar-btn" data-id="{{ pub.publicacion_id }}">
                  <i class="bi bi-bookmark-check"></i><span>Guardar</span>
                </a>
                <a href="javascript:void(0);" class="btn-link abrir-modal-reporte" data-publicacion-id="{{ pub.publicacion_id }}" data-usuario-reportado="{{ pub.usuario.usuario_id }}" data-usuario="{{ current_user.id }}">
                  <i class="bi bi-exclamation-circle"></i><span>Reportar</span>
                </a>
              </div>
            </div>
          </div>

          <div class="estrellasTarjetas">
            <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
            <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
            <i class="bi bi-star-fill"></i>
          </div>
      
        <p class="profesion"><strong>{{ pub.titulo }}</strong></p>
        
          <p class="profesion"><strong><strong>{{ pub.categoria.nombre if pub.categoria else 'Sin categoría' }}</strong></strong></p>
          <p class="descripcion-titulo">Descripción:</p>
          <p class="descripcion descripcion-texto">
             {{ pub.descripcion_publicacion }}
          </p>
          <span class="ver-mas hidden">Ver más</span>

          <div class="boton-container">
            <button class="contact-button">Contactar experto</button>
          </div>
        </div>
      </div> <!-- fin tarjeta -->
      {% endfor %}
    </div> <!-- fin slider -->
  </div> <!-- fin slider-container -->






   <!-- Flechas -->
    <div class="arrows">
      <button class="arrow-btn" id="arrowDestacadosLeft">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#35A9AE" stroke-width="2.5" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 8 8 12 12 16" />
          <line x1="16" y1="12" x2="8" y2="12" />
        </svg>
      </button>
      
      <button class="arrow-btn" id="arrowDestacadosRight">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" stroke="#35A9AE" stroke-width="2.5" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" />
          <polyline points="12 8 16 12 12 16" />
          <line x1="8" y1="12" x2="16" y2="12" />
        </svg>
      </button>
    </div>

</div> <!-- fin contenedor -->



  </div>

    {% if not session.get('jwt') %}
  <!-- SECCIÓN PARA USUARIOS NO LOGUEADOS -->
  <section class="contenedor-frases">
    <div class="contenedorfrasespeque">
      <h1 class="titulo-frases">Conecta, Publica y Encuentra:<br>Todo en un Solo Lugar</h1>
      
      <div class="servicios">
        <div class="item">
          <i class="bi bi-person-badge"></i>
          <h3>Publica tu servicio</h3>
          <p>Publica lo que sabes hacer y permite que te descubran en minutos.</p>
        </div>

        <div class="item">
          <i class="bi bi-search"></i>
          <h3>Encuentra al profesional ideal</h3>
          <p>Contrata con confianza y sin complicaciones.</p>
        </div>

        <div class="item">
          <i class="bi bi-megaphone"></i>
          <h3>Promociona</h3>
          <p>Potencia tu visibilidad y llega a más clientes.</p>
        </div>
      </div>

      <a href="{{ url_for('web.registrarse') }}" class="boton">Comienza gratis</a>

    </div>
  </section>

  {% else %}
  <!-- SECCIÓN PARA USUARIOS LOGUEADOS -->
  <section class="contenedor-frases">
    <div class="contenedorfrasespeque">
      <h1 class="titulo-frases">Tú tienes el conocimiento <br>Nosotros te conectamos con quienes lo necesitan</h1>
      
      <div class="servicios">
        <div class="item">
          <i class="bi bi-graph-up"></i>
          <h3>Haz crecer tus ingresos</h3>
          <p>Publica, chatea y coordina detalles sin intermediarios.</p>
        </div>

        <div class="item">
          <i class="bi bi-box-arrow-up"></i>
          <h3>Publica tu oferta y hazla visible</h3>
          <p>Pon tu perfil y servicios en nuestra plataforma para que te conozcan.</p>
        </div>

        <div class="item">
          <i class="bi bi-rocket"></i>
          <h3>Potencia tus publicaciones</h3>
          <p>Si quieres llegar más lejos, promociona tus publicaciones y sé la primera opción.</p>
        </div>
      </div>

      <button class="boton">Convertirse en Experto</button>
    </div>
  </section>
  {% endif %}


  








<script>
document.querySelectorAll('.guardar-link').forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    const id = link.dataset.id;
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/guardar-publicacion/${id}`;
    document.body.appendChild(form);
    form.submit();
  });
});
</script>
<script>
fetch(`/guardar-publicacion/${id}`, {
  method: 'POST'
})
.then(async res => {
  let data;
  try {
    data = await res.json();
  } catch {
    throw new Error(`Respuesta no válida: ${res.status}`);
  }
  if (!res.ok) {
    throw new Error(data.message || `Error ${res.status}`);
  }
  alert(data.message);
})
.catch(err => {
  console.error("Error en fetch:", err);
  alert("Error al guardar: " + err.message);
});


</script>


  <script src="{{ url_for('static', filename='js/inicio.js') }}"></script>
  <script src="{{ url_for('static', filename='js/errors.js') }}"></script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    const categorias = document.querySelectorAll("#sliderCategorias .categoria");
    const inputCategoria = document.getElementById("inputCategoria");
    const filtroForm = document.getElementById("filtroForm");

    categorias.forEach(categoria => {
      categoria.addEventListener("click", function () {
        const id = this.getAttribute("data-categoria-id");
        inputCategoria.value = id;
        filtroForm.submit();
      });
    });
  });
</script>

{% include 'footer.html' %}


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/modal_reportar.js') }}"></script>
</body>


</html>