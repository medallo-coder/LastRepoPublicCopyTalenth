<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configuración de Cuenta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Importa la fuente Oswald de Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Oswald:400,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/configuracion.css') }}">
  <link rel="icon" type="image/png" href="https://i.postimg.cc/26ZkKCPm/Vector.png">
</head>
<body>
  
  {% include 'nav.html' %}
  {% include 'errors.html' %}
  
  <div class="container">

    <div class="card2 header">
      <h1 class="titulo-principal">Configuración de cuenta</h1>
    </div>

    <div class="card info">
      <p><strong>Nombre de usuario:</strong> <span class="highlight">{{ primer_nombre }} {{ primer_apellido }} </span></p>
      <p id="fecha_registro">{{ fecha_registro }}</p>
      <p><strong>Rol actual:</strong> <span class="highlight">{{ rol }}</span></p>
    </div>

    <div class="card">
      <div class="flex-between">
        <p>¿Necesitas cambiar tu contraseña? Hazlo en segundos.</p>
        <button type="button" id="cambiarContraseñaBtn" class="btn-primary">Cambiar contraseña</button>
      </div>
    </div>

    <div id="formularioCambio" class="card hidden">
      <h2 class="titulo-secundario">Cambiar contraseña</h2>
      <form id="passwordForm" action="{{ url_for('web.cambiar_contraseña') }}" method="POST">
        <!-- Solo pedimos nueva y confirmar porque la lógica actual no usa la actual -->
        <label>Actual contraseña</label>
        <input id="actual_contrasena" type="password" name="actual_contrasena" required>

        <label>Nueva contraseña</label>
        <input id="nueva_contrasena" type="password" name="nueva_contrasena" required>

        <label>Repetir nueva contraseña</label>
        <input id="confirmar_contrasena" type="password" name="confirmar_contrasena" required>

        <div class="flex">
          <button type="submit" class="btn-primary">Guardar cambios</button>
          <button type="button" id="cancelarBtn" class="btn-secondary">Cancelar</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="flex-between">
        <p>Esta opción hace que tu cuenta quede en estado de deshabilitación de manera definitiva.</p>
        <button type="button" id="eliminarCuentaBtn" class="btn-primary">Eliminar cuenta</button>
      </div>
    </div>

    <div id="formularioEliminar" class="card hidden">
      <h2 class="titulo-secundario">Eliminar cuenta</h2>
      <form id="eliminarForm" action="{{ url_for('web.deshabilitar_cuenta') }}" method="POST">
        <div id="little-text">
          <p>Esta acción es permanente y no se puede deshacer.</p>
          <p>No podrás iniciar sesión ni acceder a tu perfil.</p>
          <p>Tu perfil y tus servicios dejarán de ser visibles para los usuarios.</p>
          <p>Importante: La desactivación no elimina tus datos; tu cuenta quedará registrada pero deshabilitada.</p>
        </div>
        <label>Ingresar contraseña </label>
        <input id="confirmarEliminar" type="password" name="contrasena" required>

        <div class="flex">
          <button type="submit" class="btn-primary">Eliminar</button>
          <button type="button" id="cancelarEliminarBtn" class="btn-secondary">Cancelar</button>
        </div>
      </form>
    </div>

  </div>

  <script>
    document.getElementById('cambiarContraseñaBtn').addEventListener('click', () => {
      const formulario = document.getElementById('formularioCambio');
      formulario.classList.remove('hidden');
      formulario.scrollIntoView({ behavior: 'smooth' });
      document.getElementById('cambiarContraseñaBtn').style.display = 'none';
    });

    document.getElementById('cancelarBtn').addEventListener('click', () => {
      const formulario = document.getElementById('formularioCambio');
      formulario.classList.add('hidden');
      document.getElementById('passwordForm').reset();
      document.getElementById('cambiarContraseñaBtn').style.display = 'inline-block';
    });

    document.getElementById('eliminarCuentaBtn').addEventListener('click', () => {
      const formulario = document.getElementById('formularioEliminar');
      formulario.classList.remove('hidden');
      formulario.scrollIntoView({ behavior: 'smooth' });
      document.getElementById('eliminarCuentaBtn').style.display = 'none';
    });

    document.getElementById('cancelarEliminarBtn').addEventListener('click', () => {
      const formulario = document.getElementById('formularioEliminar');
      formulario.classList.add('hidden');
      document.getElementById('eliminarForm').reset();
      document.getElementById('eliminarCuentaBtn').style.display = 'inline-block';
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const fechaRegistroText = document.getElementById('fecha_registro').textContent;
        
        // Suponemos que la fecha viene en formato "2025-05-01" o similar
        const fecha = new Date(fechaRegistroText);

        // Diccionario de meses en español
        const mesesEspanol = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];

        // Obtenemos el mes (0 basado) y el año
        const mes = fecha.getMonth();  // Esto devolverá un número entre 0 y 11
        const anio = fecha.getFullYear();

        // Formateamos la fecha en el formato deseado
        const fechaFormateada = `Se unió en ${mesesEspanol[mes]} de ${anio}`;

        // Actualizamos el contenido del <p> con la fecha formateada
        document.getElementById('fecha_registro').textContent = fechaFormateada;
    });
</script>

<!-- Modificación Camilo: Incluí el footer correctamente antes de </body>. -->
{% include 'footer.html' %}
</body>
</html>
